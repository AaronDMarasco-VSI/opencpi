<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
  <!-- This file was converted to xhtml by Writer2xhtml ver. 1.5.2. See http://writer2latex.sourceforge.net for more info. -->
  <head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <title>OCPI_ODT</title>
    <meta charset="UTF-8" />
    <meta content="" name="description" />
    <meta content="" name="keywords" />
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC" />
    <meta content="OCPI_ODT" name="DC.title" />
    <meta content="" name="DC.subject" />
    <meta content="" name="DC.description" />
    <meta content="James Kulp" name="DC.creator" />
    <meta content="2016-05-19T09:50:49.569146000" name="DC.date" />
    <meta content="en" name="DC.language" />
    <style media="all" type="text/css">
      body {font-family:Calibri,serif;font-size:13.333334px}
      span.Code {font-family:'Courier New',monospace;font-weight:bold;font-size:16.0px;background-color:transparent}
      span.FirstEmphasis {font-family:Arial,serif;font-style:italic;font-weight:bold;font-size:16.0px}
      span.DefaultParagraphFont {font-family:Arial,sans-serif;font-size:16.0px}
      a:link {font-family:Arial,sans-serif;font-size:16.0px;color:#0000ff;text-decoration:underline}
      a:visited {color:#800000;text-decoration:underline}
      a.Internet20link:link {font-family:Arial,sans-serif;font-size:16.0px;color:#0000ff;text-decoration:underline}
      a.Internet20link:visited {color:#800000;text-decoration:underline}
      p.ListNumber {margin-left:38.4px;margin-right:38.4px;margin-top:4.8px;margin-bottom:4.8px;border:none;padding:0;text-indent:-19.2px;text-align:left;font-family:Arial,serif;font-size:16.0px}
      p.Code {margin-left:24.0px;margin-right:0;margin-top:4.0032px;margin-bottom:0;border:none;padding:0;text-indent:0;text-align:left;font-family:'Courier New',monospace;font-weight:bold;font-size:14.666667px}
      p.Highlight {margin-left:0;margin-right:0;margin-top:24.0px;margin-bottom:5.7408px;border:1.0px solid #000000;padding:1.9296px;text-align:left;font-family:Arial,serif;font-size:16.0px}
      p.TableCode {margin-left:0;margin-right:0;margin-top:4.0032px;margin-bottom:0;border:none;padding:0;text-indent:0;text-align:left;font-family:'Courier New',monospace;font-weight:bold;font-size:14.666667px}
      p.Caption {margin-left:0;margin-right:0;margin-top:9.6px;margin-bottom:14.400001px;border:none;padding:0;text-align:center;font-family:Arial,serif;font-style:italic;font-size:16.0px}
      p.Revision {margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;border:none;padding:0;text-align:left;font-family:Arial,serif;font-size:9.333334px}
      p.Diagram {margin-left:0;margin-right:0;margin-top:5.7408px;margin-bottom:0;border:none;padding:0;text-align:center;font-family:Arial,serif;font-size:16.0px}
      p.TableContents {margin-left:0;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-size:14.666667px}
      p.TableCaptionbefore {margin-left:0;margin-right:0;margin-top:9.6px;margin-bottom:14.400001px;border:none;padding:0;text-align:center;font-family:Arial,serif;font-style:italic;font-size:16.0px}
      p.TableHeading {margin-left:0;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-weight:bold;font-size:16.0px}
      p.ContentsHeading {page-break-before:always;margin-left:0;margin-right:0;margin-top:15.984px;margin-bottom:8.016px;border:none;padding:0;text-align:center;font-family:'Liberation Sans',sans-serif;font-weight:bold;font-size:16.0px}
      p.Contents3 {margin-left:32.016px;margin-right:0;margin-top:0;margin-bottom:0;border:none;padding:0;text-indent:0;text-align:left;font-family:Calibri,serif;font-size:14.666667px}
      p.Contents2 {margin-left:15.984px;margin-right:0;margin-top:0;margin-bottom:0;border:none;padding:0;text-indent:0;text-align:left;font-family:Calibri,serif;font-weight:bold;font-size:14.666667px}
      p.Contents1 {margin-left:0;margin-right:0;margin-top:8.016px;margin-bottom:0;border:none;padding:0;text-align:left;font-family:Calibri,serif;font-weight:bold;font-size:16.0px}
      p.Body {margin-left:0;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-size:16.0px}
      p.caption {margin-left:0;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-align:center;font-family:Arial,serif;font-weight:bold;font-size:14.666667px;color:#4f81bd}
      p.ListBullet {margin-left:38.4px;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-indent:-19.2px;text-align:left;font-family:Arial,serif;font-size:16.0px}
      p.IndentHang {margin-left:60.019196px;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-indent:-36.0192px;text-align:left;font-family:Arial,serif;font-style:normal;font-size:16.0px}
      p.Standard {margin-left:0;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-size:16.0px}
      p.Roadmap {margin-left:48.0px;margin-right:0;margin-top:7.6703997px;margin-bottom:5.7408px;border:none;padding:0;text-indent:0;text-align:left;font-family:Arial,serif;font-style:italic;font-size:14.666667px}
      h1 {page-break-before:always;margin-left:0;margin-right:0;margin-top:15.984px;margin-bottom:4.0032px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-weight:bold;font-size:18.666668px;clear:left}
      h2 {page-break-before:always;margin-left:0;margin-right:0;margin-top:15.984px;margin-bottom:4.0032px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-style:italic;font-weight:bold;font-size:16.0px;clear:left}
      h3 {margin-left:0;margin-right:0;margin-top:15.984px;margin-bottom:4.0032px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-style:italic;font-size:16.0px;clear:left}
      h4 {margin-left:0;margin-right:0;margin-top:15.984px;margin-bottom:4.0032px;border:none;padding:0;text-align:left;font-family:Arial,serif;font-style:italic;font-size:16.0px;clear:left}
      .listlevel1Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel2Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel3Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel4Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel5Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel6Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel7Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel8Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel9Numbering1 {margin-top:0;margin-bottom:0;list-style-type:decimal;clear:left}
      .listlevel1WWNum32 {margin-top:0;margin-bottom:0;list-style-type:disc;clear:left}
      .listlevel2WWNum32 {margin-top:0;margin-bottom:0;list-style-type:bullet;clear:left}
      .listlevel3WWNum32 {margin-top:0;margin-bottom:0;list-style-type:square;clear:left}
      .listlevel4WWNum32 {margin-top:0;margin-bottom:0;list-style-type:disc;clear:left}
      .listlevel5WWNum32 {margin-top:0;margin-bottom:0;list-style-type:bullet;clear:left}
      .listlevel6WWNum32 {margin-top:0;margin-bottom:0;list-style-type:square;clear:left}
      .listlevel7WWNum32 {margin-top:0;margin-bottom:0;list-style-type:disc;clear:left}
      .listlevel8WWNum32 {margin-top:0;margin-bottom:0;list-style-type:bullet;clear:left}
      .listlevel9WWNum32 {margin-top:0;margin-bottom:0;list-style-type:square;clear:left}
      .frameGraphics {margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;border:none;padding:0;font-size:13.333334px}
      .frameGraphics p {margin-left:0;margin-right:0;margin-top:0;margin-bottom:0;font-size:13.333334px}
    </style>
  </head>
  <body dir="ltr">
    <p class="Standard" dir="ltr" style="page-break-before:always;text-align:center;font-weight:bold;font-size:37.333336px">OpenCPI<br />Installation Guide</p>
    <p class="Standard" dir="ltr" style="text-align:center;font-size:18.666668px"> </p>
    <p class="Standard" dir="ltr" style="font-size:18.666668px"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr" style="font-weight:bold;font-size:29.333334px;color:#ff0000"> </p>
    <p class="Standard" dir="ltr" style="font-weight:bold;color:#ff0000"> </p>
    <p class="Standard" dir="ltr" style="font-weight:bold;color:#ff0000"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr"> </p>
    <p class="Standard" dir="ltr" style="page-break-before:always;margin-top:0;margin-bottom:0;text-align:center;font-style:italic">Revision History</p>
    <table cellspacing="0" dir="ltr" id="Table1table" style="margin-top:0;margin-bottom:0;margin-left:auto;margin-right:auto;width:535.6704px;border-collapse:separate;border-spacing:0;table-layout:fixed">
      <tbody>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Standard" dir="ltr" style="text-align:center;font-weight:bold;font-size:10.666667px">Revision</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Standard" dir="ltr" style="text-align:center;font-weight:bold;font-size:10.666667px">Description of Change</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Standard" dir="ltr" style="text-align:center;font-weight:bold;font-size:10.666667px">Date</p>
          </td>
        </tr>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">1.0</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">Creation</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">2014-06-23</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">1.01</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">Add all FPGA and embedded system (Zed) content</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">2014-07-07</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">1.02</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">Update details for CentOS6 and Zed</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">2015-01-31</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">1.03</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">Update new simplified ZedBoard Installation</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">2015-02-27</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">1.1</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">Add ML605 details, change to use new/std doc template, bug fixes</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">2015-06-26</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:49.868797px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">1.2</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:371.9968px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">Add system.xml details</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.9968004px;padding-right:7.6703997px;vertical-align:top;width:60.8032px">
            <p class="Revision" dir="ltr" style="font-size:9.333334px">2016-05-18</p>
          </td>
        </tr>
      </tbody>
    </table>
    <div id="TableofContents1">
      <p class="ContentsHeading" dir="ltr">Table of Contents</p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">1 </span><a href="#toc0">References</a></p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">2 </span><a href="#toc1">Overview</a></p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">3 </span><a href="#toc2">Installing OpenCPI on Development Hosts</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">3.1 </span><a href="#toc3">Installing the Hardware and OS for OpenCPI Development</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.1.1 </span><a href="#toc4">Obtaining the CD Image File for the OS Installation</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.1.2 </span><a href="#toc7">Booting from, and Running the Installation CD/Image</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.1.3 </span><a href="#toc11">Enabling Your User for “sudo” and Installing “git”</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.1.4 </span><a href="#toc12">Summary of CentOS6/7 Installation Steps Prior to Installing OpenCPI</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">3.2 </span><a href="#toc13">Obtaining the OpenCPI Code Base and Installing Prerequisites</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.2.1 </span><a href="#toc14">Obtaining the OpenCPI Codebase.</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.2.2 </span><a href="#toc15">Installing Prerequisite Packages for OpenCPI</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.2.3 </span><a href="#toc16">Summary of Steps to Prepare the OpenCPI Code Base and Install Prerequisites:</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">3.3 </span><a href="#toc17">Building and Testing OpenCPI</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.3.1 </span><a href="#toc18">Building OpenCPI for Native Execution on the Development System.</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.3.2 </span><a href="#toc19">Basic Testing of the OpenCPI Installation</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.3.3 </span><a href="#toc20">Initializing your Environment to run OpenCPI Tools, Scripts and Commands</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">3.3.4 </span><a href="#toc21">Summary of Steps for Building and Testing OpenCPI's</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">3.4 </span><a href="#toc22">Overall Installation Summary</a></p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">4 </span><a href="#toc23">Preparing the OpenCPI Runtime Environment</a></p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">5 </span><a href="#toc24">Embedded Systems as Target Hosts</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">5.1 </span><a href="#toc25">The Digilent ZedBoard with Xilinx Zynq SoC Processor</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">5.1.1 </span><a href="#toc26">Establishing the Cross-Building Environment for OpenCPI targeting Zynq</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">5.1.2 </span><a href="#toc32">Creating and Populating a Directory to Create a Bootable SD Card</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">5.1.3 </span><a href="#toc39">Setting Up the ZedBoard Hardware to Run OpenCPI</a></p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">6 </span><a href="#toc51">FPGA Platforms Based on PCI Express Cards</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">6.1 </span><a href="#toc52">Installation of PCI Express-based FPGA Cards</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.1.1 </span><a href="#toc53">Ensure Sufficient Power and Cooling for the Card</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.1.2 </span><a href="#toc54">Configure any Required Jumpers and/or Switches on the Card</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.1.3 </span><a href="#toc55">Enable Bitstream Loading, and JTAG Access.</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.1.4 </span><a href="#toc56">Plug in the Card and Power up the System</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.1.5 </span><a href="#toc57">Load an OpenCPI Bitstream into the Power-up Flash Memory on the Card</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.1.6 </span><a href="#toc58">Reboot the System and Test OpenCPI's Ability to See the Card.</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">6.2 </span><a href="#toc59">Xilinx ML605 PCI-Express Card as an OpenCPI HDL Platform</a></p>
      <p class="Contents3" dir="ltr"><span class="SectionNumber">6.2.1 </span><a href="#toc60">Hardware Setup for ML605</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">6.3 </span><a href="#toc61">Altera ALST4 PCI-Express Card as an OpenCPI HDL Platform</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">6.4 </span><a href="#toc62">Altera ALST4X PCI-Express Card as an OpenCPI HDL Platform</a></p>
      <p class="Contents1" dir="ltr"><span class="SectionNumber">7 </span><a href="#toc63">FPGA Simulation Platforms</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">7.1 </span><a href="#toc64">Modelsim</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">7.2 </span><a href="#toc65">Xilinx Isim</a></p>
      <p class="Contents2" dir="ltr"><span class="SectionNumber">7.3 </span><a href="#toc66">Xilinx xsim</a></p>
    </div>
    <h1 dir="ltr" id="toc0"><span class="SectionNumber">1 </span><a id="Toc141837257"></a><a id="Toc224890089"></a><a id="Toc245388431"></a><a id="RefHeading53281790153948"></a><a id="Toc141318608"></a>References</h1>
    <p class="Standard" dir="ltr">This document assumes a basic understanding of the Linux command line (or “shell”) environment.  It does not require a working knowledge of OpenCPI, although if anything goes wrong with the installation, more experience with OpenCPI may be required.  The reference below is an overview of OpenCPI and may prove useful.</p>
    <p class="caption" dir="ltr"> </p>
    <table cellspacing="0" dir="ltr" id="Table2table" style="margin-top:0;margin-bottom:0;margin-left:0;margin-right:auto;width:624.0px;border-collapse:separate;border-spacing:0;table-layout:fixed">
      <tbody>
        <tr>
          <td style="border:1.0px solid #00000a;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;background-color:#cccccc;vertical-align:middle;width:133.3984px">
            <p class="Standard" dir="ltr" style="margin-top:4.0032px;margin-bottom:4.0032px;text-align:center;font-weight:bold;font-size:14.666667px">Title</p>
          </td>
          <td style="border:1.0px solid #00000a;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;background-color:#cccccc;vertical-align:middle;width:91.4656px">
            <p class="Standard" dir="ltr" style="margin-top:4.0032px;margin-bottom:4.0032px;text-align:center;font-weight:bold;font-size:14.666667px">Published By</p>
          </td>
          <td style="border:1.0px solid #00000a;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;background-color:#cccccc;vertical-align:middle;width:348.928px">
            <p class="Standard" dir="ltr" style="margin-top:4.0032px;margin-bottom:4.0032px;text-align:center;font-weight:bold;font-size:14.666667px">Link</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #00000a;border-left:1.0px solid #00000a;border-right:1.0px solid #00000a;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:middle;width:133.3984px">
            <p class="TableContents" dir="ltr">OpenCPI Overview</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #00000a;border-left:1.0px solid #00000a;border-right:1.0px solid #00000a;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:middle;width:91.4656px">
            <p class="Standard" dir="ltr" style="margin-top:4.0032px;margin-bottom:4.0032px;text-align:center"><a class="Internet20link" href="http://github.com/opencpi/opencpi"><span style="font-size:13.333334px">OpenCPI</span></a></p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #00000a;border-left:1.0px solid #00000a;border-right:1.0px solid #00000a;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:middle;width:348.928px">
            <p class="Standard" dir="ltr" style="margin-top:4.0032px;margin-bottom:4.0032px;text-align:center"><span style="font-size:13.333334px">Public URL:<br /></span><a class="Internet20link" href="https://github.com/opencpi/opencpi/raw/master/doc/pdf/OpenCPI_Overview.pdf"><span style="font-size:14.666667px">https://github.com/opencpi/opencpi/doc/pdf/OpenCPI_Overview.pdf</span></a></p>
          </td>
        </tr>
      </tbody>
    </table>
    <h1 dir="ltr" id="toc1"><span class="SectionNumber">2 </span><a id="Toc245388432"></a><a id="RefHeading53301790153948"></a><a id="Toc224890090"></a>Overview</h1>
    <p class="Standard" dir="ltr">This document describes how to install OpenCPI.  The installation is in layers that are mostly optional depending on which platforms are being used.  The core installation is the development “host” that allows both for local software-based execution of OpenCPI applications and components, as well as cross-building for other platforms.</p>
    <p class="Standard" dir="ltr">The default installation platform for OpenCPI development hosts is (as of May 2016) CentOS7 Linux x86_64 (64-bit).  Other Linux variants and 32-bit systems have been used successfully, but CentOS7 64-bit is the default, tested, installation for a development host.  Development hosts can either be actual physical systems or virtual machine installations.</p>
    <p class="Standard" dir="ltr">Additional installation options exist for other target processors and technologies such as the Xilinx Zynq SoC (with ARM processor cores and FPGA resources), and various FPGAs.  Preference is given to <span style="font-style:italic">cross-building</span> for embedded CPUs when possible, rather than self-hosting development tools on such platforms, in order to limit the complexities of installing tools on different development hosts.</p>
    <p class="Standard" dir="ltr">This document is divided into sections for different classes of target platforms:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Development hosts (virtual and physical)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Embedded CPUs</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">FPGA platforms.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">GPU platforms</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">In each section, when appropriate, the physical/electrical installation issues will be addressed as well as issues for installing any required tools on the development host.</p>
    <p class="Standard" dir="ltr">A final section lists specific reference platforms that are commonly used and frequently tested.</p>
    <p class="Standard" dir="ltr">In several sections it is noted that certain features are “roadmap items”.  This means that the need for the feature is clear and recognized, and it is on the list of features to be implemented in some future release.</p>
    <h1 dir="ltr" id="toc2"><span class="SectionNumber">3 </span><a id="RefHeading91193798513454"></a>Installing OpenCPI on Development Hosts</h1>
    <p class="Standard" dir="ltr">The basic installation of (Linux) development host systems enables the development and execution of OpenCPI components and applications on the development host itself (called <span style="font-style:italic">native</span> execution).  It also establishes the host platform for the tools that enable development for other target platforms, including embedded CPUs, FPGAs, and GPUs.</p>
    <p class="Standard" dir="ltr">The installation process takes these steps, in three phases:</p>
    <p class="Standard" dir="ltr"><span style="font-weight:bold">Phase 1:</span>  Hardware and OS installation</p>
    <ol class="listlevel1Numbering1">
      <li>
        <p class="ListNumber" dir="ltr">Installing the hardware or creating a bare virtual machine.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Installing and configuring the operating system from CD or CD image file.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Updating the operating system to the latest patch level, and enable “sudo”.<br /><br /><span style="font-style:italic">At this this point we have a basic up-to-date OS installation.  There are many ways to get here, but we outline a basic approach that works on CentOS6 and CentOS7.  If your system is already installed, this phase is not needed.</span></p>
      </li>
    </ol>
    <p class="Standard" dir="ltr" style="font-style:normal;font-weight:bold">Phase 2:<span style="font-weight:normal">  Download OpenCPI sources, and install prerequisite software packages.</span></p>
    <ol class="listlevel1Numbering1">
      <li>
        <p class="ListNumber" dir="ltr">Install the “git” software package, and use it to download the OpenCPI source distribution.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Install standard prerequisite packages using the package update and installation tools of the operating system distribution.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Configure the (non-default aspects of) the OpenCPI environment.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Install and build some prerequisite packages that need special OpenCPI-supplied installation scripts.<br /><br /><span style="font-style:italic">At this point we have installed all prerequisites and have a clone/copy of the OpenCPI code tree on our OS installation.</span></p>
      </li>
    </ol>
    <p class="Standard" dir="ltr"><span style="font-style:normal;font-weight:bold">Phase 3:</span><span style="font-style:italic"> </span><span style="font-style:normal"> Build and test OpenCPI</span></p>
    <ol class="listlevel1Numbering1">
      <li>
        <p class="ListNumber" dir="ltr">Build OpenCPI's core tools, libraries, components and example applications.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Execute some tests to verify that the installation is working.</p>
      </li>
    </ol>
    <p class="Standard" dir="ltr">These steps result in a development system with tools and runtime software ready to support development and native execution (on the development system) of OpenCPI components and applications.  In most cases, steps 5 through 8 can be done with a single command.</p>
    <p class="Roadmap" dir="ltr">It is a roadmap item to have a minimal, precompiled “component development kit” that requires fewer steps, and less file space.</p>
    <p class="Standard" dir="ltr">The following section describes phase 1:  <a class="Internet20link"><span class="FirstEmphasis">Installing the Hardware and OS for OpenCPI Development</span></a>.  Subsequent sections describe phase 2:  <a class="Internet20link"><span class="FirstEmphasis">Obtaining and Configuring OpenCPI and Prerequisites</span></a>, and phase 3:  <a class="Internet20link"><span class="FirstEmphasis">Building OpenCPI and Testing Native Execution</span></a>.  For other target systems and platforms see the sections on embedded systems and FPGA platforms.</p>
    <h2 dir="ltr" id="toc3"><span class="SectionNumber">3.1 </span><a id="RefHeading72461466527820"></a>Installing the Hardware and OS for OpenCPI Development</h2>
    <p class="IndentHang" dir="ltr">	<span style="font-style:italic">The quick description of this OS installation section is:  install CentOS6 or CentOS7 with the “git” software installed and your user id enabled for “sudo”.</span></p>
    <p class="Standard" dir="ltr">This step is only necessary if you are installing the OS from scratch.  If your OS is already installed and up to date, your account is already <span class="Code">sudo</span>-enabled, and the <span class="Code">git</span> command is available on your system, you can skip to the <a class="Internet20link"><span class="FirstEmphasis">Obtaining the OpenCPI Code Base and Installing Prerequisites</span></a> section below.</p>
    <p class="Standard" dir="ltr">To just deal with the <span class="Code">sudo</span> and <span class="Code">git</span> issues on an installed OS, skip to: <a class="Internet20link"><span class="FirstEmphasis">Enabling Your User for “sudo” and Installing “git”</span></a></p>
    <p class="Standard" dir="ltr">Since a development host has no special hardware requirements, it must simply support the recommended and supported development host operating systems (currently CentOS7 Linux 64-bit).  Some development tools (especially those for FPGAs) require large memories and exploit multiple CPU cores <span style="font-family:Arial,serif;font-size:16.0px">and</span> thus the minimum memory should be at least 8GB, with 16B or more preferred.  For test purposes, VMs with 2GB have been successful, but slow.</p>
    <p class="Standard" dir="ltr">If the development host will also host other embedded CPU or FPGA cards acting as OpenCPI target platforms, the appropriate slots, cooling and power supplies should be considered.</p>
    <p class="Standard" dir="ltr">If the development host will also be the runtime host for ethernet-attached devices (such as the Ettus N210), it is sometimes useful to use dedicated ethernet ports for such devices.  In this case a host system with multiple ethernet ports/interfaces should be considered.  This minimizes interference between Ethernet traffic to the locally-attached platforms, and general LAN or WAN/Internet traffic.</p>
    <p class="Standard" dir="ltr">OpenCPI development is commonly hosted on laptops, server machines with card slots, and virtual machines hosted on other operating systems.  One example system is a CentOS7 64-bit virtual machine running under the “Parallels” virtual machine system on Apple MacBook Pro laptops.  Another is a Dell server with well-powered PCI Express slots for hosting a number of FPGA and/or GPU boards.</p>
    <h3 dir="ltr" id="toc4"><span class="SectionNumber">3.1.1 </span><a id="RefHeading762381466527820"></a>Obtaining the CD Image File for the OS Installation</h3>
    <p class="Standard" dir="ltr">The normal operating system installation starts with a CD image downloaded from centos.org (or one it its mirrors).  Two examples of CentOS installations are described here.  Many installation scenarios are possible.</p>
    <p class="Standard" dir="ltr">For a physical system, you can burn this file onto a real CD/DVD, and then boot from that physical CD/DVD.  For a virtual machine, you can usually designate that the CD/DVD image file be mounted to the virtual machine as a virtual CD/DVD device.</p>
    <p class="Standard" dir="ltr">Creating a virtual machine usually involves answering a few questions about the to-be-created VM, and then booting it from the Installation CD/DVD image file.  Using the “parallels” VM system under MacOS, the most import questions to answer are the amount of memory to give to the VM, and the number of cores to provide.  Each VM system does it slightly differently.</p>
    <p class="Standard" dir="ltr">Booting the development host system from the CD or CD image file proceeds the same whether it is a physical system or a VM.</p>
    <p class="IndentHang" dir="ltr" style="font-style:italic">	For the case of using the Parallels VM system on Macs we select “customize settings before installation”, and set memory at 4GB and 2 cores/CPUs.</p>
    <h4 dir="ltr" id="toc5"><span class="SectionNumber">3.1.1.1 </span>CentOS6:  with the Live CD Installation Image</h4>
    <p class="Standard" dir="ltr">The CD image for CentOS6, for the “live CD” installation, is currently available from a mirror on this site:</p>
    <p class="Code" dir="ltr">http://isoredirect.centos.org/centos/6/isos/x86_64/</p>
    <p class="Standard" dir="ltr"><span style="font-style:italic">The trailing slash is required in the above URL</span>.  The actual file name to download is:</p>
    <p class="Standard" dir="ltr" style="font-style:italic">CentOS-6.7-x86_64-LiveCD.iso</p>
    <p class="Standard" dir="ltr">The <span class="Code"><span style="font-size:14.666667px">md5sum.txt</span> </span>file in the same directory provides the md5 checksum for the file to check against after downloading using the <span class="Code">md5</span> command (on MacOS) or the <span class="Code">md5sum</span> command on Linux:</p>
    <p class="Code" dir="ltr">% md5sum CentOS-6.7-x86_64-LiveCD.iso<br />339b607c497fe6b524da36803420ca61  CentOS-6.7-x86_64-LiveCD.iso</p>
    <p class="Body" dir="ltr">This installation, when booted from the CD image, runs Linux itself, with a desktop environment, that can then be used to install your system.</p>
    <h4 dir="ltr" id="toc6"><span class="SectionNumber">3.1.1.2 </span>CentOS7:  with the Minimal CD Installation Image</h4>
    <p class="Standard" dir="ltr">The CD image for the minimal CentOS7 installation is available from mirrors at:</p>
    <p class="Code" dir="ltr">http://isoredirect.centos.org/centos/7/isos/x86_64/</p>
    <p class="Standard" dir="ltr"><span style="font-style:italic">The trailing slash is required in the above URL</span>.  The actual file name to download is:</p>
    <p class="Code" dir="ltr">CentOS-7-x86_64-Minimal.iso</p>
    <p class="Standard" dir="ltr">This installation is suitable for command-line only (no GUI) headless systems, and booting from the CD (image) immediately runs the installer.  Other CensOS7 installation images are available with more packages preinstalled on the image.</p>
    <h3 dir="ltr" id="toc7"><span class="SectionNumber">3.1.2 </span>Booting from, and Running the Installation CD/Image</h3>
    <h4 dir="ltr" id="toc8"><span class="SectionNumber">3.1.2.1 </span>CentOS6 with Live CD Image</h4>
    <p class="Standard" dir="ltr">The Live CD/DVD boot comes up as a CentOS6 system hosted on the CD itself, and there is an icon on the desktop called “Install to Hard Drive”, which installs the CentOS6 OS on the hard drive (or virtualized HD for a VM).  Double-clicking on this “Install to Hard Drive” icon will start the generic CentOS6 installation process:  see the figure below.</p>
    <p class="Diagram" dir="ltr"><img alt="Image2" class="frameGraphics" id="Image2graphic" src="OpenCPI_Installation-img/OpenCPI_Installation-img001.png" style="background-color:#ffffff;width:561.4464px;height:361.92963px" /></p>
    <p class="Caption" dir="ltr">Figure 1:  CentOS6 Installation Screen after booting from Installation CD</p>
    <p class="Standard" dir="ltr">The “Install to Hard Drive” will then ask questions about:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">the keyboard language (we chose <span style="font-style:italic">English (United States)</span>)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">storage device types (we chose Basic Storage Devices)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">whether to discard the HD contents (we answer Yes, discard any data)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">the network host name of the system (we chose livecd.centos.6.7)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">timezone</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">root password</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">whether to “use all space” on the HD (we chose “Use All Space”)</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">Finally, select “write changes to disk” to make the HD installation complete.</p>
    <p class="Standard" dir="ltr">This results in the (possibly virtual) HD-based system having a CentOS6 installation with the screen as follows:</p>
    <p class="Diagram" dir="ltr"><img alt="Image3" class="frameGraphics" id="Image3graphic" src="OpenCPI_Installation-img/OpenCPI_Installation-img002.png" style="width:575.47205px;height:411.47522px" /></p>
    <p class="Caption" dir="ltr">Figure 2:  Screen after Installation to HD from CD or CD Image File</p>
    <p class="Standard" dir="ltr">Pressing “Close” at this screen exits the initial CD-to-HD installation process.  You should now:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Remove/eject the installation CD/CD-image to ensure it is not used on the reboot.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Reboot using the “System-&gt;Shut Down...” menu item, and choose the “Restart” option.</p>
      </li>
    </ul>
    <p class="Body" dir="ltr">This will result in your new HD-based CentOS6 installation booting for the first time, and asking more installation questions like:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">License agreement (agree)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Create User</p>
      </li>
    </ul>
    <p class="IndentHang" dir="ltr">	<span style="font-style:italic">In certain NFS mounting scenarios it is useful to create a user with the same user-id number and group-id number as the host system you will use as an NFS server.  In this case select the “Advanced...” button in the CreateUser screen and create the user there.</span></p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Date and Time (use NTP or set manually)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Kdump (disable in most cases)</p>
      </li>
    </ul>
    <p class="Body" dir="ltr">At this point you can log in as the newly created user.</p>
    <h4 dir="ltr" id="toc9"><span class="SectionNumber">3.1.2.2 </span><a id="RefHeading87262116501284"></a>Performing Software Update on the New CentOS6 Installation</h4>
    <p class="Standard" dir="ltr">Assuming you have a good internet connection, you should update your software using the “System-&gt;Administration-&gt;Software Update” menu item, and, assuming there are updates, the “Install Updates” button.  You should repeat this process until there are no updates to install since there can be dependencies that require more than one “Software Update”.  When there are no more updates, you should restart again using “System-&gt;Shut Down...-&gt;Restart”</p>
    <p class="Standard" dir="ltr">After restarting it is conceivable that there are more updates, so you should try “Software Update” one more time to verify there are no more updates.</p>
    <p class="Standard" dir="ltr">At this point you have a fully updated (for the default set of software packages) CentOS6 system.  If you are on a VM system with support for “snapshots”, you should probably take one at this point.</p>
    <h4 dir="ltr" id="toc10"><span class="SectionNumber">3.1.2.3 </span>CentOS7 with Minimal CD Image</h4>
    <p class="Standard" dir="ltr">When this image boots it immediately runs an installer that asks for things like language, and root password.  It is better to not create users at this point, but to simply run the installer.  When the installed system boots, it is in command line (shell) mode.  At this point you must at least enable the network interface using the <span class="Code">nmtui</span> tool (the default network interface is <span class="Code">eth0</span>), and then update your system using the</p>
    <p class="Code" dir="ltr"><span class="Code"># yum update</span></p>
    <p class="Standard" dir="ltr">command.  To ensure you are up to date, you must reboot (using the <span class="Code">reboot</span> command) after <span class="Code">yum update</span>, and then, after the reboot, run <span class="Code">yum update</span> again, and repeat this process until it says there are no updates.</p>
    <p class="Standard" dir="ltr">On the command line you can add users, using the simple <span class="Code">adduser</span> command.  An example would be:</p>
    <p class="Code" dir="ltr"># adduser -m -N -r -u 505 -g 20 user1</p>
    <p class="Standard" dir="ltr">You only need to specify the user and group ids if you are trying to match them to an existing installation for convenient <span class="Code">nfs</span> mounting.  Otherwise yuo can simply use:</p>
    <p class="Code" dir="ltr"># adduser -m user1</p>
    <p class="Standard" dir="ltr">This would use default behavior to create the account and home directory.</p>
    <h3 dir="ltr" id="toc11"><span class="SectionNumber">3.1.3 </span><a id="RefHeading762441466527820"></a>Enabling Your User for “sudo” and Installing “git”</h3>
    <p class="Standard" dir="ltr">A number of scripts supplied by OpenCPI require that the user be enabled for the “sudo” command.  You should add your user account to the list of accounts that are allowed to use “sudo”.  For CentOS6 Linux, this can be accomplished in a terminal window (from Applications-&gt;System Tools-&gt;Terminal).  On the CentOS7 minimal installation you are already at the command line.  With &lt;RootPasswd&gt; and &lt;User&gt; being replaced by your root password and your user name, do:</p>
    <p class="Code" dir="ltr">% su<br />Password: <span style="font-style:italic">&lt;RootPasswd&gt;<br /></span># echo <span style="font-style:italic">&lt;User&gt;</span> ALL = ALL &gt;&gt; /etc/sudoers<br /># exit<br />%</p>
    <p class="Standard" dir="ltr">The “% “ and “# “ are just command prompts:  you don't type them.  Be careful to use the two “&gt;&gt;” characters to append the line to the file.  Of course if you are experienced <span style="font-family:Arial,serif;font-size:16.0px">with</span> Linux, you may do this many other ways.</p>
    <p class="Standard" dir="ltr">OpenCPI has several software prerequisites, but only one of them is required to be installed <span style="font-style:italic">before</span> the OpenCPI code base is installed:  <span style="font-weight:bold">git</span>.  The git program is used to download a local copy of the code base, and after that, a script <span style="font-style:italic">in</span> the code base is used to finish the installation of OpenCPI.  To obtain “git”, the following command should be issued at the command prompt in the terminal window:</p>
    <p class="Code" dir="ltr">% sudo yum -y install git</p>
    <p class="Standard" dir="ltr">This ensures that you have the “git” package installed on your system so that you can use the <span class="Code">git</span> command.  <span class="Code">Git</span> is the distributed revision control system used by OpenCPI.  We will only use a few <span class="Code">git</span> features and commands for installation.</p>
    <h3 dir="ltr" id="toc12"><span class="SectionNumber">3.1.4 </span><a id="RefHeading87282116501284"></a>Summary of CentOS6/7 Installation Steps Prior to Installing OpenCPI</h3>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Download the CentOS CD image file, and check the md5 digest.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">For physical systems, burn a CD from that file.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Boot the physical or VM system from the CD or CD image file.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Run the installer using the “Install to HardDrive” icon and answer questions.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Boot your newly installed system and answer more questions.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Upgrade the software repeatedly until there are no more updates available.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Enable your user ID for the <span class="Code">sudo</span> command.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Install the <span class="Code">git</span> configuration management software.</p>
      </li>
    </ul>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5"><span style="background-color:#cfe7f5">You now have an installed, up-to-date operating system, with a user account that is         sudo-enabled and the </span><span class="Code"><span style="background-color:#cfe7f5">git</span></span><span style="background-color:#cfe7f5"> software configuration management package installed.          </span>                                                                                                                         </span></p>
    <h2 dir="ltr" id="toc13"><span class="SectionNumber">3.2 </span><a id="RefHeading72521466527820"></a>Obtaining the OpenCPI Code Base and Installing Prerequisites</h2>
    <h3 dir="ltr" id="toc14"><span class="SectionNumber">3.2.1 </span><a id="RefHeading91195798513454"></a>Obtaining the OpenCPI Codebase.</h3>
    <p class="Standard" dir="ltr">Assuming you are in a terminal window, in the directory where the codebase should go (in a subdirectory named <span class="Code">opencpi</span>, <span style="font-style:italic">which the following command will create</span>), type:</p>
    <p class="Code" dir="ltr">% git clone https://github.com/opencpi/opencpi.git</p>
    <p class="Standard" dir="ltr">This will create an <span class="Code">opencpi</span> subdirectory and populated it with the current OpenCPI code base:  i.e., a “git clone” of the code base that can be easily updated in the future.  You should change into this directory for further commands:</p>
    <p class="Code" dir="ltr">% cd opencpi</p>
    <p class="Standard" dir="ltr">By default, the “git clone” operation downloads the “latest and greatest” or “bleeding edge” version of the code.  This may or may not be what you want.  After downloading, if you want a specific, perhaps more stable release, you use the “git tag” command to list the tagged releases available, then set the code base to the one you want using “git checkout”, using the release tag (as listed by “git tag”) as an argument.</p>
    <p class="Standard" dir="ltr">The OpenCPI releases are identified by calendar quarter (released at the end of the quarter), and patch release within that quarterly release.  The release compatibility policy is to maintain component binary compatibility within the releases for a given quarter, and source compatibility (requiring rebuilding) for new quarterly releases.  Patch releases within a quarter still require rebuilding OpenCPI itself since the distribution is source-based for now.  Early releases of a next-quarter release are identified with minor releases starting with “rc” for “release candidate”.  Here are some examples of OpenCPI release tags.</p>
    <p class="Code" dir="ltr">% git tag<br />OpenCPI-1.0<br />OpenCPI-2015.Q1.rc0<br />OpenCPI-2016.Q2.rc0<br />%</p>
    <p class="Standard" dir="ltr">To set the release of the codebase you downloaded, you use the “git checkout” command with the release tag as an argument:</p>
    <p class="Code" dir="ltr">% git checkout OpenCPI-2015.Q1.rc0</p>
    <p class="Standard" dir="ltr">This will result in some messages about “detached HEAD”, which can be ignored unless you are modifying OpenCPI itself, rather than just using it for component or application development.  To do development on OpenCPI itself, and potentially submit patches, etc., you need to know more about <span class="Code">git</span>.  To simply return the codebase to be the latest version, you can do that by using <span class="Code">master</span> as the tag.</p>
    <p class="Code" dir="ltr">% git checkout master</p>
    <p class="Standard" dir="ltr">Whenever you check out a different tag <span style="font-style:italic">after</span> any building activity, you should perform a clean operation on the code base:</p>
    <p class="Code" dir="ltr">% make clean</p>
    <p class="Standard" dir="ltr">This should only be done after building, and with an environment set up as described below.</p>
    <h3 dir="ltr" id="toc15"><span class="SectionNumber">3.2.2 </span><a id="RefHeading762461466527820"></a>Installing Prerequisite Packages for OpenCPI</h3>
    <p class="Standard" dir="ltr">The next step is to run a script in the OpenCPI code base that will install other required packages.  The script does this in two ways, depending on whether the package:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">is a standard optional package for CentOS6/7 using the CentOS <span class="Code">yum install</span> command, or</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">needs OpenCPI-supplied scripts to do a <span style="font-style:italic">custom-for-OpenCPI</span> build and installation</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">This script will first create the <span style="font-family:&apos;Courier New&apos;,monospace;font-weight:bold">/opt/opencpi</span> directory since that is where the second category of prerequisite packages are installed.  To install the prerequisites, type:</p>
    <p class="Code" dir="ltr">% scripts/install-prerequisites.sh</p>
    <p class="Standard" dir="ltr">This step and the next two can all be executed in one step using the <span class="Code">scripts/install-opencpi.sh</span> script for those who are impatient.</p>
    <p class="Standard" dir="ltr">The standard packages from the CentOS repository <span style="font-family:Arial,serif;font-size:16.0px">will be installed globally on the system, and thus be available to all environments and applications.  If they are already installed, nothing will be done.  To see which packages are installed, look at this script and the ones it calls.  The second category, installed with OpenCPI-supplied installation scripts, will be installed in a place (</span><span style="font-family:&apos;Courier New&apos;,monospace;font-weight:bold;font-size:16.0px">/opt/opencpi</span><span style="font-family:Arial,serif;font-size:16.0px">), where they will be used by OpenCPI, but will not be available globally and will not affect any other installation of the same package.  If you need this directory to be somewhere else, make a symbolic link in </span><span class="Code">/opt/opencpi</span><span style="font-family:Arial,serif;font-size:16.0px"> that points to that other place: </span></p>
    <p class="Roadmap" dir="ltr"><span style="font-family:Arial,serif;font-size:16.0px">It is a roadmap item to allow a directory name other than /</span><span class="Code">opt/opencpi</span><span style="font-family:Arial,serif;font-size:16.0px"> to be used.</span></p>
    <h3 dir="ltr" id="toc16"><span class="SectionNumber">3.2.3 </span><a id="RefHeading87302116501284"></a>Summary of Steps to Prepare the OpenCPI Code Base and Install Prerequisites:</h3>
    <p class="Code" dir="ltr">% git clone https://github.com/opencpi/opencpi.git<br />% cd opencpi<br />% git tag<br />% git checkout OpenCPI-2015.Q1.rc0    # use tag if necessary<br />% scripts/install-prerequisites.sh</p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">You now have an OpenCPI installation with all prerequisites installed, and are ready to    build OpenCPI.                                                                                                                  </span></p>
    <h2 dir="ltr" id="toc17"><span class="SectionNumber">3.3 </span><a id="RefHeading762481466527820"></a>Building and Testing OpenCPI</h2>
    <p class="Standard" dir="ltr">Now that all the prerequisites <span style="font-family:Arial,serif;font-size:16.0px">are</span> installed, we can build OpenCPI.</p>
    <h3 dir="ltr" id="toc18"><span class="SectionNumber">3.3.1 </span><a id="RefHeading91197798513454"></a>Building OpenCPI for Native Execution on the Development System.</h3>
    <p class="Standard" dir="ltr">Building OpenCPI builds several different things in different steps, but all with one script.  That building script will:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Build the core software infrastructure libraries, and utility command executables.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Build the software component libraries. (components in the default library usable for applications)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Build some example applications</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Build the OpenCPI Linux kernel/device driver</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">All these steps are executed by the <span class="Code">build-opencpi.sh</span> script:</p>
    <p class="Code" dir="ltr">% scripts/build-opencpi.sh</p>
    <p class="Standard" dir="ltr">When this script succeeds, all software aspects of OpenCPI have been built and can execute in the development host environment.  No OpenCPI runtime code has been executed at this point.</p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">You now have an OpenCPI installation with all of OpenCPI, including libraries,                commands, software components and applications, installed and ready to run.  This        does not include FPGA tools, code, or bitstreams, which are installed/built elsewhere.      </span></p>
    <h3 dir="ltr" id="toc19"><span class="SectionNumber">3.3.2 </span><a id="RefHeading762501466527820"></a>Basic Testing of the OpenCPI Installation</h3>
    <p class="Standard" dir="ltr">Run the <span class="Code">scripts/test-opencpi.sh</span> script to perform a simple “smoke test” to see if OpenCPI appears to be installed correctly.  This script runs a set of tests that are simple pass-fail tests that should complete successfully.</p>
    <p class="Code" dir="ltr">% <span class="Code">scripts/test-opencpi.sh</span></p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">You now have an OpenCPI installation that appears to work correctly when running         native applications.                   									</span></p>
    <h3 dir="ltr" id="toc20"><span class="SectionNumber">3.3.3 </span><a id="RefHeading762521466527820"></a>Initializing your Environment to run OpenCPI Tools, Scripts and Commands</h3>
    <p class="Body" dir="ltr">Up to now, all the installation scripts have relied upon an environment that is set up  without any customization.  The next step is to create an initialization script for yourself.  Assuming you are using CentOS6 and want to call your script <span class="Code">my-env.sh</span>, you make a copy of the example script:</p>
    <p class="Code" dir="ltr">% cp example_c6_env.sh my-env.sh</p>
    <p class="Body" dir="ltr">You can then customize this script, especially to specify the locations of various other tools you may have installed.  You should make any changes <span style="font-family:Arial,serif;font-size:16.0px">necessary for your environment.  For native execution, no changes may be necessary, but when third party tools are required for other platforms, their locations and/or license file locations typically need to be set in this file.</span></p>
    <p class="Body" dir="ltr">This script must be sourced (not executed) in any command shell or window that will use OpenCPI for development.  This is accomplished by:</p>
    <p class="Code" dir="ltr">% source my-env.sh</p>
    <p class="Body" dir="ltr">It may be convenient to put this line in your “~/.profile” or “~/.bashrc” files, but do this with care since it may affect all command windows and scripts, which may cause problems interacting with other packages' environment settings.</p>
    <p class="Body" dir="ltr">The <span class="Code">example_c6_env.sh</span> script is an example that shows a number of possible settings, especially for FPGA tools.  There is an <span class="Code">example_c7_env.sh</span> for CentOS7.</p>
    <h3 dir="ltr" id="toc21"><span class="SectionNumber">3.3.4 </span><a id="RefHeading87322116501284"></a>Summary of Steps for Building and Testing OpenCPI's</h3>
    <p class="Code" dir="ltr">% scripts/build-opencpi.sh<br />% <span class="Code">scripts/test-opencpi.sh<br /><span style="font-style:italic">(Create and customize your own environment setup script)</span><br />% source my-env.sh<br /><span style="font-style:italic">(Do this step in any window or shell that will use OpenCPI)</span></span></p>
    <h2 dir="ltr" id="toc22"><span class="SectionNumber">3.4 </span><a id="RefHeading923001466527820"></a>Overall Installation Summary</h2>
    <p class="Standard" dir="ltr">The steps to be taken to install OpenCPI on a typical development system are:</p>
    <ol class="listlevel1Numbering1">
      <li>
        <p class="ListNumber" dir="ltr">Obtain an Operating System Installation CD (or for VMs, a CD image file)</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Install the operating system</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Update the operating system to the current patch level.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Enable the current user for <span class="Code">sudo</span> permission.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Install the <span class="Code">git</span> configuration management software if not already installed.<br /><br /><span style="font-style:italic">The above steps are for a generic OS installation that you may already have done and can be done in many ways.</span></p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Get the OpenCPI code base using <span class="Code">git clone</span> and check out the desired version.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Run the OpenCPI installation script for installing prerequisite packages.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Run the script to build OpenCPI</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Run the script to do the installation runtime test of OpenCPI</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Create and customize your environment setup script.</p>
      </li>
    </ol>
    <p class="Body" dir="ltr">When you simply want the most recent version of OpenCPI, steps 6 through 9 can be done using two commands:</p>
    <p class="Code" dir="ltr">% git clone https://github.com/opencpi/opencpi.git</p>
    <p class="Code" dir="ltr">% scripts/install-opencpi.sh</p>
    <h1 dir="ltr" id="toc23"><span class="SectionNumber">4 </span><a id="RefHeadingToc326151944612760"></a>Preparing the OpenCPI Runtime Environment</h1>
    <p class="Standard" dir="ltr">OpenCPI components and applications can be executed on an OpenCPI development host with no configuration or other preparation beyond the instructions above.  However, there are several configuration options that are available for execution time, as different from development.  These options are either environment variables or in a runtime system configuration file, that is normally found in <span class="Code">/opt/opencpi/system.xml</span>.</p>
    <p class="Standard" dir="ltr">The environment variables that can affect runtime behavior are:</p>
    <p class="TableCaptionbefore" dir="ltr">Table 1:  Environment Variables for Runtime Configuration</p>
    <table cellspacing="0" dir="ltr" id="Table3table" style="margin-top:0;margin-bottom:0;margin-left:0;margin-right:auto;width:624.4032px;border-collapse:separate;border-spacing:0;table-layout:fixed">
      <tbody>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableHeading" dir="ltr" style="font-size:14.666667px">Name</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableHeading" dir="ltr" style="font-size:14.666667px">Description</p>
          </td>
        </tr>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_CDK_DIR</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr" style="font-size:14.666667px">The location of the runtime software installation.  There is no default, this variable must be set.  The most common value for a binary installation is <span class="Code">/opt/opencpi/cdk</span>.  For a source installation it is the <span class="Code">exports</span> subdirectory of the source tree.</p>
          </td>
        </tr>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_LOG_LEVEL</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr" style="font-size:14.666667px">The log level (amount of logging) output by the runtime system.  The default if not set is zero (<span class="Code">0</span>), indicating no logging output.  The maximum logging is <span class="Code">20</span>.  Commonly useful startup and diagnostic information is provided at log level <span class="Code">8</span>.  Unusual events are logged at level <span class="Code">4</span>.</p>
          </td>
        </tr>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_PROJECT_PATH</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr">The set of projects used to find simulation platforms when they are not in the binary distribution.  This value is used for other purposes during development tasks.</p>
          </td>
        </tr>
        <tr>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_SYSTEM_CONFIG</p>
          </td>
          <td style="border:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr" style="font-size:14.666667px">The runtime system XML configuration file.  Default is <span class="Code">/opt/opencpi/system.xml</span></p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_SUPPRESS_HDL_NETWORK_DISCOVERY</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr" style="font-size:14.666667px">Set to 1 to avoid any overhead incurred to search for network-based HDL devices, including simulation servers.</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_DMA_MEMORY</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr" style="font-size:14.666667px">When the OpenCPI kernel driver is not used, this environment variable allows super-user privileged processes to specify physical DMA memory to use.  The format is <span class="Code"><span style="font-style:italic">&lt;mbytes&gt;</span>M$0x<span style="font-style:italic">&lt;address&gt;</span></span>, with <span class="Code"><span style="font-style:italic">mbytes</span></span> in decimal, and <span class="Code"><span style="font-style:italic">address</span></span> in hexadecimal.</p>
          </td>
        </tr>
        <tr>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:252.92801px">
            <p class="TableCode" dir="ltr" style="font-size:12.0px">OCPI_SMB_SIZE</p>
          </td>
          <td style="border-top:none;border-bottom:1.0px solid #000001;border-left:1.0px solid #000001;border-right:1.0px solid #000001;padding-top:0;padding-bottom:0;padding-left:7.5360003px;padding-right:7.2000003px;vertical-align:top;width:337.99362px">
            <p class="TableContents" dir="ltr" style="font-size:14.666667px">This variable specifies the size (in bytes, decimal) of the memory pool used for buffers in software containers.</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="Standard" dir="ltr">The OpenCPI system configuration file is an XML file that allows additional parameters to be specified that affect the runtime system.  Its location is usually /opt/opencpi/system.xml, but its location may also be specified by the environment varoable <span class="Code">OCPI_SYSTEM_CONFIG</span>.  It is organized hierarchically according to the major runtime software module hierarchy.  An example is:</p>
    <p class="Code" dir="ltr" style="font-size:13.333334px">&lt;opencpi&gt;<br />  &lt;container&gt;<br />    &lt;ocl load='0'/&gt;<br />    &lt;rcc load='1'/&gt;<br />    &lt;hdl load='1'&gt;<br />      &lt;device name="PCI:0000:05:00.0" esn="000013C1E1F401"/&gt;<br />      &lt;device name="PCI:0000:04:00.0" esn="91d28408"/&gt;<br />    &lt;/hdl&gt;<br />    &lt;remote load='1'/&gt;<br />  &lt;/container&gt;<br />  &lt;transfer smbsize='128K'&gt;<br />    &lt;pio load='1'/&gt;<br />    &lt;!-- &lt;dma load='1'/&gt; --&gt;<br />    &lt;sockets load='1'/&gt;r<br />  &lt;/transfer&gt;<br />&lt;/opencpi&gt;</p>
    <p class="Standard" dir="ltr">The two top level categories of configurable modules are:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr"><span class="FirstEmphasis">container:</span>  for the runtime modules (drivers) that support different authoring models</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr"><span class="FirstEmphasis">transfer:</span>  for the runtime modules (drivers) that support different dataplane transport mechanisms.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">Each driver has a boolean <span class="Code">load</span> attribute that specifies whether the module should be loaded (and thus enabled) in the runtime environment.  Otherwise all attributes are module-specific.</p>
    <p class="Standard" dir="ltr">The <span class="Code">device</span> child element can appear under any of the container driver elements and specifies attributes specific to individual devices supporting that container type.  In the example above, an <span class="Code">esn</span> attribute is applied to two HDL devices, which is used to indicate the electronic serial numbers of the JTAG cables attached to specific PCI devices.</p>
    <p class="Standard" dir="ltr">The <span class="Code">smbsize</span> attribute to the transfer element specifies a default value for the size in bytes of the buffer memory pool for each dataplane endpoint.  It can also be applied to each module below it which overrides the default.</p>
    <h1 dir="ltr" id="toc24"><span class="SectionNumber">5 </span><a id="RefHeading91199798513454"></a>Embedded Systems as Target Hosts</h1>
    <p class="Standard" dir="ltr">In this document we use the term <span class="FirstEmphasis">embedded systems</span> for processors and systems that will execute OpenCPI components and applications, but are generally <span style="font-style:italic">not</span> used to build or compile OpenCPI or components.  Our primary example is the Digilent ZedBoard, which has a Xilinx Zynq SoC chip which contains 2 ARM cores for software and an FPGA section for “gateware”.</p>
    <p class="Standard" dir="ltr">When using any embedded system, the first step is to install the appropriate cross-compilation tools on your development system.  While some embedded systems can actually host their own tools, we generally avoid this in order to avoid burdening the embedded platform with such tools, and also avoid challenges associated with porting the OpenCPI development environment to a new platform.</p>
    <p class="Standard" dir="ltr">If no Linux-hosted cross-tools are available for the embedded target, then the OpenCPI build/development environment must indeed be ported to that platform, and any incompatibilities must be addressed.  The OpenCPI development environment does not have many dependencies, but they must all be addressed on the new development platform.  This is a partial list of dependencies that some aspects of the OpenCPI development environment require:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">C and C++ compilers and linkers</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Bash and Make</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Python</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Miscellaneous POSIX utilities such as “tr”, “sed”, “cp”, etc.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">When other cross-tools and/or FPGA tools are required for a target platform, other prerequisites may be required.</p>
    <p class="Standard" dir="ltr">Along with using cross-compilers we generally assume (in a development context) that the embedded system has a network interface that will allow it to mount and access the file systems on the development system where the OpenCPI codebase is built and cross-built.  This also requires that the development system be enabled as a file server, and any associated firewall issues are addressed between the embedded system and the development host.  This configuration typically uses nfs, with the embedded system acting as an <span class="Code">nfs</span> client, and the development system as the <span class="Code">nfs</span> server.  If the development system is not yet configured for nfs, the appropriate software is installed using the command:</p>
    <p class="Code" dir="ltr">% sudo yum install nfs-utils</p>
    <p class="Standard" dir="ltr">When network access to the development system is unavailable, inconvenient, or inappropriate, then a small subset of the OpenCPI cross-built environment is copied to the embedded system to enable execution without any network.  This is called “standalone” or “embedded” mode for OpenCPI on the embedded system.</p>
    <p class="Standard" dir="ltr">One key build option for OpenCPI is whether to build all libraries and executables with static linking or dynamic linking.  When built with static linking, executables are truly standalone and don't require many libraries to be copied to the embedded system.</p>
    <p class="Standard" dir="ltr" style="page-break-before:always">For each embedded system that is supported, we divide <span style="font-family:Arial,serif;font-size:16.0px">the</span> instructions into these steps:</p>
    <ol class="listlevel1Numbering1">
      <li>
        <p class="ListNumber" dir="ltr">Install cross development tools and cross-build OpenCPI on the development system.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Create a bootable kit (usually an SD card) to install on the embedded system, using the development system.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Set up the hardware as needed for OpenCPI.</p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">Install the bootable kit (usually plugging in an SD card) on the embedded system.</p>
      </li>
    </ol>
    <h2 dir="ltr" id="toc25"><span class="SectionNumber">5.1 </span><a id="RefHeading91201798513454"></a>The Digilent ZedBoard with Xilinx Zynq SoC Processor</h2>
    <p class="Standard" dir="ltr">This hardware platform is the smallest and least expensive platform that can support software and FPGA development using OpenCPI.</p>
    <p class="Roadmap" dir="ltr">Supporting the even-smaller “MicroZed” platform (with the Z-7010 device) is considered feasible and is a roadmap item.</p>
    <p class="Standard" dir="ltr">The steps below describe the process of building OpenCPI and preparing a bootable SD card from scratch, including assets from a Xilinx Linux kernel release as well as those built in OpenCPI.  However, there is a shortcut that allows you to bypass all these steps if you just want to quickly run OpenCPI on a ZedBoard:  a directory in the OpenCPI code base contains a prebuilt SD card directory that can simply be copied to a real SD card that can then be inserted into a ZedBoard before restarting it.</p>
    <p class="Standard" dir="ltr">Assuming the SD card (first partition usually entitled “BOOT”) is mounted on <span class="Code">/media/xyz</span>, the following commands will remove its current contents and copy the OpenCPI contents onto it and unmount it so you can remove it and plug it into a ZedBoard.</p>
    <p class="Code" dir="ltr">% rm -r -f /media/xyz/*<br />% cp -r -p platforms/zed/release/OpenCPI-SD/* /media/xyz<br />% umount /media/xyz</p>
    <p class="Standard" dir="ltr">To use this shortcut, you still need to at least arrange for console access to the ZedBoard, as described in the section below.</p>
    <p class="Standard" dir="ltr">After removing the SD card, plug it into a properly configured (powered off) ZedBoard, power on and run some simple applications that are already there.  If this will serve your purposes (initially), you can skip the rest of this section and proceed to the section for ZedBoard hardware setup.  Of course you can add any of your own files to the SD card.</p>
    <p class="Standard" dir="ltr">Summary:  you can use the pre-built SD card contents unless:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">You need to use a more up-to-date OpenCPI version.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">You need a more up-to-date or different Xilinx Linux release.</p>
      </li>
    </ul>
    <h3 dir="ltr" id="toc26"><span class="SectionNumber">5.1.1 </span><a id="RefHeading91203798513454"></a>Establishing the Cross-Building Environment for OpenCPI targeting Zynq</h3>
    <p class="Standard" dir="ltr">This section describes how to build OpenCPI for the ZedBoard and enable building applications and components for it.  It is what you do on a development system (not on the ZedBoard) before doing anything on the ZedBoard hardware.  The basic steps are summarized at the end of this section.</p>
    <h4 dir="ltr" id="toc27"><span class="SectionNumber">5.1.1.1 </span><a id="RefHeadingToc333411235158909"></a>Install Xilinx ISE and EDK Tools</h4>
    <p class="Standard" dir="ltr">There are two aspects to building for Zynq:  user mode code and kernel driver code.  Both rely on the cross-compiler supplied in the Xilinx tools release (the EDK).  Thus the first prerequisite is to install Xilinx ISE and EDK tools.  We will refer to the Xilinx release number as $XRN, and the pathname where Xilinx releases are installed as $XROOT.  In a typical installation, $XRN might be 14.7, and $XROOT might be /opt/Xilinx, so the current release would be installed in the</p>
    <p class="Code" dir="ltr">/opt/Xilinx/<span class="Code">14.7</span></p>
    <p class="Standard" dir="ltr">directory.  This procedure has not been tested on ISE releases prior to 14.6 and is unlikely to work on prior releases.  Be sure to include the EDK in the installation (when running the Xilinx installer) since that is where the cross compiler and some other required files come from.  At the current time OpenCPI does not support the Xilinx Vivado tools, only ISE and EDK.  The XRN and XROOT variables are notional for this document.  You do not need to actually set or use those variables.</p>
    <p class="Standard" dir="ltr">We assume a Xilinx ISE+EDK installation on CentOS6 or CentOS7 64-bit Linux, the standard OpenCPI development host.  Xilinx officially supports Red Hat Enterprise Workstation 6 (64-bit), of which CentOS/64-bit is a free “clone”, without any support.</p>
    <p class="Standard" dir="ltr">We also assume that you have created a clone of the OpenCPI git repository, placed it in a directory on a development system (e.g. /home/myself/opencpi), and built and run OpenCPI on that development host system.  Instructions for this are above.  When an OpenCPI environment is established on the development system, the root of the OpenCPI source distribution will be in the <span class="Code">OCPI_BASE_DIR</span> environment variable.</p>
    <p class="Standard" dir="ltr">The OpenCPI ZedBoard installation includes certain artifacts that are derived from one or more Xilinx Linux kernel releases.  Under normal circumstances these can be used as they exist in the OpenCPI tree.  The <span class="Code">platforms/zed/release</span> file is a link to the Xilinx linux release (inside the OpenCPI tree) that will be used during the remaining installation steps.  If you need to change or customize the Xilinx Linux kernel release, see the <span class="Code">platforms/zed/README.linux</span> file.  We also assume a successful OpenCPI development host installation (and runtime tests) as described above.  In the standard environment for OpenCPI development, the <span class="Code">OCPI_BASE_DIR</span> environment variable specifies where the OpenCPI source code base resides.</p>
    <p class="Standard" dir="ltr">In summary, the prerequisites for using OpenCPI on the ZedBoard (and other Zynq-based platforms) are:</p>
    <ol class="listlevel1Numbering1">
      <li>
        <p class="ListNumber" dir="ltr">A working OpenCPI installation on CentOS/64-bit at <span class="Code">$OCPI_BASE_DIR</span></p>
      </li>
      <li>
        <p class="ListNumber" dir="ltr">A Xilinx ISE+EDK installation at $XROOT/$XRN, e.g. /<span style="font-family:&apos;Courier New&apos;,monospace;font-weight:bold">opt/Xilinx/14.7</span></p>
      </li>
    </ol>
    <h4 dir="ltr" id="toc28"><span class="SectionNumber">5.1.1.2 </span><a id="RefHeadingToc333431235158909"></a>Establish and Customize your Cross Build Environment</h4>
    <p class="Standard" dir="ltr">To build OpenCPI for Zynq/ARM software development, we use the Xilinx-EDK-supplied ARM/Zynq cross-build tools (cross from CentOS x86_64 to Zynq).  There is nothing specific to the ZedBoard platform about these Zynq tools.  The <span class="Code">example_zed_env.sh</span> file in the <span class="Code">$OCPI_BASE_DIR</span> is an example you should copy (say, into <span class="Code">myzed.sh</span>) and customize as necessary for your own environment (perhaps changing the name of the license file).  Your script may set the OCPI_XILINX_DIR, OCPI_XILINX_VERSION, and OCPI_XILINX_LICENSE_FILE environment variables if they are not correct.  Assuming you have already built OpenCPI for CentOS6/64-bit, you need to source this customized environment script in a <span style="font-style:italic;text-decoration:underline">new</span> shell/window, in $OCPI_BASE_DIR, e.g.:</p>
    <p class="Code" dir="ltr">% source myzed.sh</p>
    <p class="Standard" dir="ltr">Sourcing this file in a window/shell that was previously used for OpenCPI (e.g. for building OpenCPI for the development host), could cause problems.</p>
    <p class="Standard" dir="ltr">Sourcing this <span class="Code">myzed.sh</span> script establishes a cross-build environment by setting environment variables that point to the cross-compilation tools in the Xilinx EDK installation (among other things).</p>
    <p class="Standard" dir="ltr">You do <span style="font-style:italic;font-weight:bold">not</span> need to run any Xilinx-supplied initialization scripts.  Using these Xilinx ISE+EDK tools for cross-compilation has been tested in ISE 14.6 and 14.7.</p>
    <h4 dir="ltr" id="toc29"><span class="SectionNumber">5.1.1.3 </span><a id="RefHeadingToc333451235158909"></a>Installing/Cross-Building Prerequisites for the Zed Embedded Target.</h4>
    <p class="Body" dir="ltr">Before building OpenCPI for the embedded target, the prerequisite libraries must be installed and cross-built for this embedded target.  This uses the same script as for the development host, but it is running in a cross-building environment set up by your <span class="Code">myzed.sh</span> script.</p>
    <p class="Code" dir="ltr">% scripts/install-prerequisites.sh</p>
    <h4 dir="ltr" id="toc30"><span class="SectionNumber">5.1.1.4 </span><a id="RefHeadingToc333471235158909"></a>Build Software for Zed Using the Xilinx-supplied Cross-Compiler Tools</h4>
    <p class="Standard" dir="ltr">After the above environment setup, the normal OpenCPI build should function and succeed, but will now be cross-building for the Zynq.</p>
    <p class="Code" dir="ltr">% scripts/build-opencpi.sh</p>
    <p class="Standard" dir="ltr">This should succeed and produce no unusual warnings.  It is essentially equivalent to:</p>
    <p class="Code" dir="ltr">% make &amp;&amp; make rcc &amp;&amp; make examples &amp;&amp; make driver</p>
    <p class="Standard" dir="ltr">It will build the Zynq versions of all OpenCPI libraries, executables, components, examples, and kernel driver for the Zynq Linux platform.  This will <span style="font-style:italic">not</span> interfere with the libraries, executables and components already built for the native CentOS/64-bit environment.  With OpenCPI, all compilation results are placed in target-specific directories, so building for multiple targets in the same tree is supported and expected.</p>
    <p class="Standard" dir="ltr">Building the OpenCPI kernel driver relies on the release of the Xilinx Linux kernel that is already established in the OpenCPI tree, in <span class="Code">platforms/zed/release</span>.  In particular, the kernel aspects of the OpenCPI build rely on a "kernel headers" package created there.</p>
    <h4 dir="ltr" id="toc31"><span class="SectionNumber">5.1.1.5 </span><a id="RefHeadingToc333491235158909"></a>Build FPGA Libraries, Components, Platform and Bitstreams</h4>
    <p class="Standard" dir="ltr">In order to build the HDL/FPGA code, including test bitstreams, you do:</p>
    <p class="Code" dir="ltr">% make hdl HdlPlatforms="isim_pf zed"</p>
    <p class="Standard" dir="ltr">This will build all the primitive libraries, components, bitstreams for ZedBoard's Zynq chip and for isim (the ISE simulator).  If you had already built OpenCPI HDL/FPGA code for other Xilinx targets, the <span class="Code">isim_pf</span> aspect of the build may already have been done and thus will not be rebuilt.  For previous OpenCPI HDL developers:  the OpenCPI <span class="Code">HdlTarget</span> for the ZedBoard is <span class="Code">zynq</span> and the <span class="Code">HdlPlatform</span> is <span class="Code">zed</span>.  This step can take an hour or more.</p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">This is the end of building all the OpenCPI assets for development and execution on the ZedBoard.												</span></p>
    <h3 dir="ltr" id="toc32"><span class="SectionNumber">5.1.2 </span><a id="RefHeading91205798513454"></a>Creating and Populating a Directory to Create a Bootable SD Card</h3>
    <p class="Standard" dir="ltr">The final software step to perform on the development system is to create and populate a directory to be copied to an SD card that can be plugged into the ZedBoard for booting.  The contents of the SD card directory tree is a combination of:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Binary files from a Xilinx Linux Kernel release from <a class="Internet20link" href="http://www.wiki.xilinx.com/Zynq+Releases">http://www.wiki.xilinx.com/Zynq+Releases</a></p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Binary files built and stored in the OpenCPI tree that were patched from the Xilinx release and Linux source code.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Core files from the OpenCPI tree built from sources.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Component library files from the OpenCPI tree (RCC and HDL).</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">This resulting SD card can be used standalone (independent of the network) or based on a network connection that allows the <span class="Code">zed</span> platform to communication with the development system.  The network-based development setup mounts the development system from the ZedBoard using NFS, so usually very few files really need to be on the SD card itself.  In standalone mode, OpenCPI can be used with the files on the SD card, and with no network.</p>
    <p class="Standard" dir="ltr">There is a populated SD card tree at <span class="Code">platforms/zed/release/OpenCPI-SD </span>that can be used directly, but it is not updated for every patch release in the Xilinx repository.  These instructions prepare a directory tree for an SD card locally (in this directory), to be copied to a real SD card, that can then be unmounted, plugged into the Zed board, and used to boot the ZedBoard.</p>
    <p class="Standard" dir="ltr">There are two files that must be customized before making the SD card.  One for standalone mode and one for network mode (NFS mounting of the development system).  If you are not using the network/NFS mode you can ignore the second one.</p>
    <h4 dir="ltr" id="toc33"><span class="SectionNumber">5.1.2.1 </span><a id="RefHeadingToc333511235158909"></a>Standalone Mode Startup Script</h4>
    <p class="Standard" dir="ltr">You should make copy of the <span class="Code">defaultsetup.sh</span> file into <span class="Code">mysetup.sh</span> (here in the <span class="Code">platforms/zed</span> directory) and customize it, in particular, specifying at least:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">The system to be used as a time server</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Your timezone.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">At least in CentOS6 and CentOS7, the following command will print what the timezone should say:</p>
    <p class="Code" dir="ltr">% tail -1 /etc/localtime</p>
    <p class="Standard" dir="ltr">These items are on the command line in mysetup.sh that runs the internal zedsetup.sh script, which configures the ZedBoard system for OpenCPI each time it boots.  Since the ZedBoard has no real time clock these are needed to set the time properly.  If you truly have no network connection, you can set the time server to "<span class="Code">-</span>" and set the time manually when the ZedBoard system is booted.</p>
    <p class="Standard" dir="ltr">When the SD card is created, this script will be copied to it, and it is run each time the system is booted (manually for now).</p>
    <p class="Code" dir="ltr">% cp defaultsetup.sh mysetup.sh<br />{ customize mysetup.sh }</p>
    <h4 dir="ltr" id="toc34"><span class="SectionNumber">5.1.2.2 </span><a id="RefHeadingToc333531235158909"></a>Network Mode Startup Script</h4>
    <p class="Standard" dir="ltr">Network mode is when you mount the development system (and the OpenCPI tree), as an NFS server with the ZedBoard as NFS client.  This provides easy and dynamic access to all of OpenCPI, and presumably any components and applications you may have.  You can avoid customizing this file if you only want to use standalone mode, but you must make sure the <span class="Code">mynetsetup.sh</span> exists.</p>
    <p class="Standard" dir="ltr">Make a copy of the <span class="Code">defaultnetsetup.sh</span> file into <span class="Code">mynetsetup.sh</span> (here in the <span class="Code">platforms/zed</span> directory) and customize it, in particular, specifying at least:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">The NFS "share name" of your development system.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">The directory name relative to that mountable file system where the OpenCPI tree lives.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">The system to be used as a time server.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Your timezone description.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">All these items are on the command line in <span class="Code">mynetsetup.sh</span> that runs the z<span class="Code">ednetsetup.sh</span> script, which configures the zed system for OpenCPI each time it boots, for network/NFS mode.  The network address of your development system will be specified later, dynamically, as an argument to <span class="Code">mynetsetup.sh</span>.</p>
    <p class="Code" dir="ltr">% cp defaultnetsetup.sh mynetsetup.sh<br />{ customize mynetsetup.sh }</p>
    <p class="Standard" dir="ltr">Note the <span class="Code">mynetsetup.sh</span> script you copied to the SD card takes the development system's IP address as an argument.  If it is fixed, you could hard-wire it in this script.</p>
    <h4 dir="ltr" id="toc35"><span class="SectionNumber">5.1.2.3 </span><a id="RefHeadingToc333551235158909"></a>Create New SD Card Contents</h4>
    <p class="Standard" dir="ltr">To create a directory that can be copied to an SD card, you use the <span class="Code">makeSD.sh</span> script.  If run with no arguments it describes what it will do.  If the single argument is "<span class="Code">-</span>", then it will populate the SD card based on the current Xilinx Zynq Linux release installed in the OpenCPI tree.  The current Xilinx Linux release is shown by doing: "<span class="Code">ls -l release</span>", which shows a link to the current release.  If there are other releases present, you can select a different one by indicating it as the first argument.</p>
    <p class="Standard" dir="ltr">This script depends on the <span class="Code">OCPI_LIBRARY_PATH</span> environment variable, since it copies all valid component artifacts found in this path to the SD card staging directory.</p>
    <p class="Code" dir="ltr">% ./makeSD.sh -</p>
    <p class="Standard" dir="ltr">This script combines kernel release binaries from Xilinx, some linux artifacts customized for OpenCPI, and the various compiled files in the OpenCPI tree.  It creates a directory called "<span class="Code">release/OpenCPI-SD</span>" after removing the previous one. It also includes the <span class="Code">mysetup.sh</span> and <span class="Code">mynetsetup.sh</span> that you have just customized.  You can further customize it if needed to add contents to the SD card, or of course put additional content on the SD card itself later.</p>
    <h4 dir="ltr" id="toc36"><span class="SectionNumber">5.1.2.4 </span><a id="RefHeadingToc333571235158909"></a>Initialize (partition, erase) the SD Card</h4>
    <p class="Standard" dir="ltr">This step completely initializes, formats, and partitions the SD card, whereas the next step copies the contents onto it. This step creates a 200MB boot partition in FAT32 format, and also creates a second linux ext2/ext3 file system using the rest of the space on the card.  Because it is partitioning the drive from scratch, there must be no mounted file systems on the drive when it is executed.</p>
    <p class="Standard" dir="ltr">If you don't want a "fresh" SD card, but want to use an existing one that is correctly formatted for a ZedBoard boot disk, you can skip this step.</p>
    <p class="Standard" dir="ltr">You must determine the linux device name of the SD card, usually something like /dev/sdb.  The "<span class="Code">sudo fdisk -l</span>" command describes all disk devices on the system and can help in identifying the device for the SD card you plugged in.  Using the wrong device name could erase the disk, <span style="font-style:italic">so be careful!  </span>Also, you can use the "<span class="Code">mount</span>" command to see if any of the partitions of the disk are already mounted.  They should be unmounted before running this script.</p>
    <p class="Standard" dir="ltr">The following script completely reinitializes/partitions/erases the SD card for use with the ZedBoard.  The single argument is the linux disk device name.  The "sudo" is usually necessary unless the device has general write permission.</p>
    <p class="Code" dir="ltr">% sudo ./formatSD.sh /dev/sdX</p>
    <h4 dir="ltr" id="toc37"><span class="SectionNumber">5.1.2.5 </span><a id="RefHeadingToc333591235158909"></a>Copy the Prepared SD File Tree to the Actual SD Card.</h4>
    <p class="Standard" dir="ltr">The source of this step is the directory created by the <span class="Code">makeSD.sh</span> script above, which is <span class="Code">release/OpenCPI-SD</span>.  If you have just formatted the SD card with the previous step, you would need to mount it first using the mount command, or simply unplug it and plug it in again, which normally automatically mounts it.</p>
    <p class="Standard" dir="ltr">After the “BOOT” partition is mounted (e.g. /dev/sdb1 is mounted on /media/boot) do:</p>
    <p class="Code" dir="ltr">% rm -r -f /media/boot/*<br />% cp -r -p release/OpenCPI-SD/* /media/boot</p>
    <p class="Standard" dir="ltr">If you have more files to add, do so now, then remove it using:</p>
    <p class="Code" dir="ltr">% umount /media/boot</p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">At this point you have a development environment ready for the ZedBoard, have built all the libraries, executables, components, and examples for both software and FPGA, and have prepared a bootable SD card.								</span></p>
    <h4 dir="ltr" id="toc38"><span class="SectionNumber">5.1.2.6 </span><a id="RefHeadingToc333611235158909"></a>Summary of Pre-Hardware Steps to Prepare to Run OpenCPI on a ZedBoard</h4>
    <p class="Standard" dir="ltr">Assuming you not taking the shortcut mentioned at the top of this section:</p>
    <p class="Standard" dir="ltr">From the top level directory of an OpenCPI source code installation a.k.a. <span class="Code">$OCPI_BASE_DIR</span>, that is already functional for the CentOS system, with a Xilinx ISE+EDK installation, in a fresh/new shell/window, do these steps:</p>
    <p class="Code" dir="ltr">% cp example_zed_env.sh myzed.sh<br />{ customize myzed.sh for your build environment, e.g. where Xilinx tools are }<br />{ customize the Xilinx Linux release if needed - see README.linux if you need to}<br />% source myzed.sh<br />% scripts/install-prerequisites.sh<br />% scripts/build-opencpi.sh<br />% make hdl HdlPlatforms='isim_pf zed'<br />% cd platforms/zed<br />% cp defaultsetup.sh mysetup.sh<br />% cp defaultnetsetup.sh mynetsetup.sh<br />{ customize mysetup.sh and mynetsetup.sh for your environment, etc. }<br />% ./makeSD.sh -<br />{ If you need a freshly formatted SD card:<br />   plug your SD card in and figure out what the disk device name is for it.<br />   unmount any mounted partitions on the drive/disk<br />   BE CAREFUL TO GET IT RIGHT SINCE THAT DISK WILL BE ERASED<br />   % sudo ./formatSD.sh /dev/sdX<br />}<br />{ Plug in the SD card, e.g. mounted as /media/xyz }<br />% rm -r -f /media/xyz/*<br />% cp -r -p release/OpenCP-SD/* /media/xyz<br />% umount /media/xyz</p>
    <p class="Standard" dir="ltr">Now everything is built and ready for the ZedBoard, and you have a bootable SD card for using OpenCPI on a ZedBoard.  The next section describes how to install the hardware and set it up to execute based on the OpenCPI system you just built and the SD card you created.  There are two usage modes, one is network-based, where the ZedBoard can talk to the development (CentOS) system via network and NFS, and the other is standalone/embedded mode where OpenCPI can be used even without a network connection.</p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">Now everything is built and ready for the ZedBoard:  you have a bootable SD card for     using OpenCPI on a ZedBoard.									</span></p>
    <h3 dir="ltr" id="toc39"><span class="SectionNumber">5.1.3 </span><a id="RefHeading91207798513454"></a>Setting Up the ZedBoard Hardware to Run OpenCPI</h3>
    <p class="Standard" dir="ltr">This section describes how, after installing Xilinx tools, installing and building OpenCPI (software and FPGA aspects) for Zynq/Zed, and preparing an SD card, you actually set up your ZedBoard itself to run OpenCPI applications and components on the Zed itself.</p>
    <p class="Standard" dir="ltr">These steps do not enable any particular devices that might be attached to the FPGA/PL part of the Zynq.</p>
    <p class="Standard" dir="ltr">Always be careful of static electricity when touching the board.  Touch some metal shell first each time.  Start with the power cable disconnected.  The metal shell of the network connector is a good thing to touch first.</p>
    <h4 dir="ltr" id="toc40"><span class="SectionNumber">5.1.3.1 </span><a id="RefHeadingToc333631235158909"></a>Set Up the Hardware Jumpers and Switches</h4>
    <p class="Standard" dir="ltr">It is a good idea to have the Digilent ZedBoard Hardware Users Guide at:</p>
    <p class="Code" dir="ltr">http://www.zedboard.org/sites/default/files/documentations/<br />   ZedBoard_HW_UG_v2_2.pdf</p>
    <p class="Standard" dir="ltr">The “Jumpers” section has good photographs showing the location of jumpers on the board.  Only change the jumpers when the power is OFF.  These are the required jumper settings:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">MIO 2:	set to GND</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">MIO 3:	set to GND</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">MIO 4:	set to 3V3</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">MIO 5:	set to 3V3</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">MIO 6:	set to GND</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">J18:	VADJ Set to 1.8V (the setting is labelled 1V8)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">JP6:	shorted (only needed for "CES" silicon versions)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">JP2:	shorted (needed to power USB peripherals or dongles).JP2:	shorted</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">JP6:	shorted (<span style="font-style:italic">note: we didn't have enough jumpers and this wasn't needed</span>)</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">All other jumpers should be left unshorted.  The power switch should be off.</p>
    <h4 dir="ltr" id="toc41"><span class="SectionNumber">5.1.3.2 </span><a id="RefHeadingToc333651235158909"></a>Insert the SD Card into the Socket on the Bottom of the Board.</h4>
    <p class="Standard" dir="ltr">Notice that the SD card is plugged in with its label down since that connector socket is on the back of the board.</p>
    <h4 dir="ltr" id="toc42"><span class="SectionNumber">5.1.3.3 </span><a id="RefHeadingToc333671235158909"></a>Connect the Supplied Micro-USB-to-normal-USB-cable to a System</h4>
    <p class="Standard" dir="ltr">This cable is what provides access to the ZedBoard's serial console.  It must be connected to a system with a terminal emulator set to 115200 baud, 8 data bits, 1 stop bit, no parity.  There are two different connectors on the board:  be sure to use the one labelled: <span class="Code">UART</span>, and <span style="font-style:italic">not</span> the one labelled <span class="Code">USB OTG</span>.</p>
    <h4 dir="ltr" id="toc43"><span class="SectionNumber">5.1.3.4 </span><a id="RefHeadingToc333691235158909"></a>Apply Power to the ZedBoard</h4>
    <p class="Standard" dir="ltr">With the power supply cable connected, turn the power switch on.  The green POWER LED should come on.  The system has actually booted itself, but without a console attached you can't really see anything.</p>
    <h4 dir="ltr" id="toc44"><span class="SectionNumber">5.1.3.5 </span><a id="RefHeadingToc333711235158909"></a>Get Access to the Serial Console of the ZedBoard, and Reboot from There</h4>
    <p class="Standard" dir="ltr">Since the OpenCPI development environment is running on a Linux system (usually CentOS6 or 7), you can just plug this USB cable into that Linux system, and it will automatically create a <span class="Code">/dev/tty<span style="font-style:italic">XXX</span></span> file for this connection when you plug it in and the ZedBoard is powered up.  You need to determine this pathname and watch it come and go when you disconnect and reconnect the USB cable (or when the ZedBoard is powered down and up).  Typically the file name is /<span class="Code">dev/ttyACM0</span>, but not always.</p>
    <p class="Standard" dir="ltr">Without any other configuration of the Linux development host, you typically have to add read/write permission to this "/dev/tty*" file manually <span style="font-style:italic">each time the cable is connected and/or the ZedBoard is powered on</span>, using the command:</p>
    <p class="Code" dir="ltr">% sudo chmod a+rw /dev/ttyACM0</p>
    <p class="Standard" dir="ltr">(assuming the <span class="Code">/dev/tty<span style="font-style:italic">XXX</span></span> file created for that cable is /<span class="Code">dev/ttyACM0</span>, which is the default for the first such hot-plugged USB/serial cable on CentOS6).  Again, this must be done each time the board is power cycled or disconnected.  To eliminate this step you can add a <span class="FirstEmphasis">udev</span> rule to your system for the <span class="Code">/dev/tty<span style="font-style:italic">XXX</span></span> in question by issuing this command:</p>
    <p class="Code" dir="ltr">% echo 'KERNEL=”ttyACM0”, MODE=”0666”' | \<br />  sudo dd of=/etc/udev/rules.d/99-opencpi-tty.rules</p>
    <p class="Standard" dir="ltr">With the <span class="Code">/dev/ttyXXX</span> existing and with proper permissions, you must run a serial console terminal emulator program on the development system that is attached to the USB cable from the UART connector on the ZedBoard.  There are many alternative terminal emulation applications to provide for this USB remote serial console for the ZedBoard (or any similar board).  One that is available in the standard CentOS repository is "screen", obtainable by simply using:</p>
    <p class="Code" dir="ltr">% sudo yum install screen</p>
    <p class="Standard" dir="ltr">Then in any terminal window, you can do:</p>
    <p class="Code" dir="ltr">% screen /dev/ttyACM0 115200</p>
    <p class="Standard" dir="ltr">To exit this program, you use the sequence: Control-a followed by backslash.</p>
    <p class="Standard" dir="ltr">For Emacs users, you can use the serial terminal emulator built in to Emacs, by simply doing:  <span class="Code">M-x serial-term</span> in a window, and providing the <span class="Code">/dev/ttyACM0</span> name and 115200 baud rate when prompted.  There are two modes in this window, "char" and "line".  The default is "char" mode, where every character typed is immediately sent without any interpretation at all.  This means no emacs commands work in that emacs window and you have to use the mouse to switch to another emacs window.  The "line" mode is more line buffered, like "shell" mode, and all line editing and other emacs commands work fine.  <span style="font-style:italic">But</span> the display can get confused in this line mode so you have sometimes switch back and forth:  control-c control-j switches to line mode, control-c control-k switches to char mode, control-c control-c sends a control C in char mode.</p>
    <p class="Standard" dir="ltr">With a good terminal emulator connection, hit return a few times in the serial console window to see the "<span class="Code">zynq login:</span>" prompt, or, if the system was previously logged in and running, you might see the "<span class="Code">root@zynq:~#</span>" prompt.  You must login as "root" with the password "root".</p>
    <p class="Standard" dir="ltr">Sometimes if the screen or terminal emulator is confused, or if, after hitting "return", the prompt stays on the same line, try typing the command "clear", to clear the state of the terminal emulator.</p>
    <p class="Standard" dir="ltr">In normal usage it is generally best to log into the board using SSH via the network and leave the console window alone.  After the board boots, you can log in with SSH without using the console at all if you know the DHCP network address — or see it on the console output.  The <span class="Code">ifconfig</span> command on the ZedBoard will print the internet address.</p>
    <p class="Standard" dir="ltr">You can now log in (root, root), and see that rebooting works fine by both trying the "reboot" command, as well as pressing the reset button on the board (labeled: <span class="Code">PS_RST</span>).</p>
    <p class="Highlight" dir="ltr"><span style="background-color:#cfe7f5">Now you know Linux can boot, and that you have console access.				</span></p>
    <h4 dir="ltr" id="toc45"><span class="SectionNumber">5.1.3.6 </span><a id="RefHeadingToc333731235158909"></a>Get the Network Working to Talk to the Development System</h4>
    <p class="Standard" dir="ltr" style="font-style:italic;font-weight:bold">If you want to start in standalone mode, without needing a network or connection to the development host, skip to Standalone Mode section below.</p>
    <p class="Standard" dir="ltr">To enable the network connection to the development host, connect the ethernet connector on the ZedBoard to a LAN with DHCP.  The green light that is part of the network connector socket should come on to indicate that you have a network connection.</p>
    <p class="Standard" dir="ltr">You can also use USB network dongles, with the appropriate cable adapters, plugged into the <span class="Code">USB OTG</span> connector.</p>
    <p class="Standard" dir="ltr">Reboot the ZedBoard to have it come up properly on the network.  You can reboot either by typing the <span class="Code">reboot</span> command, pressing the <span class="Code">PS-RST</span> button, or turning the power switch off and on.  Power cycling might cause you to need to do another "<span class="Code">sudo chmod a+rw /dev/ttyACM0</span>".  After reboot, and re-login on the console, you can use the <span class="Code">ifconfig</span> command to confirm that the "<span class="Code">eth0</span>" interface (or "<span class="Code">eth1</span>" for USB Ethernet dongles) has an internet address, courtesy of DHCP.  E.g. the output below shows we have the internet address <span class="Code">10.0.1.108</span>.</p>
    <p class="Code" dir="ltr">root@zynq:~# ifconfig<br />eth0  Link encap:Ethernet  HWaddr 00:0A:35:00:01:22  <br />      inet addr:<span style="background-color:#ffff00">10.0.1.108</span>  Bcast:0.0.0.0  Mask:255.255.255.0<br />      inet6 addr: fe80::20a:35ff:fe00:122/64 Scope:Link<br />      UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br />      RX packets:42 errors:0 dropped:1 overruns:0 frame:0<br />      TX packets:14 errors:0 dropped:0 overruns:0 carrier:0<br />      collisions:0 txqueuelen:1000 <br />      RX bytes:6793 (6.6 KiB)  TX bytes:1737 (1.6 KiB)<br />      Interrupt:54 Base address:0xb000 </p>
    <p class="Standard" dir="ltr">The network address is also printed out on the console during booting.  To check connectivity, use <span class="Code">ping</span> in both directions:  ping your development host from the ZedBoard console and ping your ZedBoard from your development host.  If both pings work you have network connectivity.</p>
    <h4 dir="ltr" id="toc46"><span class="SectionNumber">5.1.3.7 </span><a id="RefHeadingToc333751235158909"></a>Enable NFS on the Development Host for the "share" that Includes OpenCPI</h4>
    <p class="Standard" dir="ltr">There are many "cookbook" files for setting up NFS on Linux systems.  You need to export a mountable directory above the directory where OpenCPI is installed.</p>
    <p class="Standard" dir="ltr">An example might be, if <span class="Code">OCPI_BASE_DIR</span> was <span class="Code">/home/user/opencpi</span>, and <span class="Code">/home</span> was NFS-mountable, then the “share” would be <span class="Code">/home</span>, and the OpenCPI subdirectory would be <span class="Code">user/opencpi</span><span class="DefaultParagraphFont">.  On CentOS6, you can enable NFS using the System-&gt;Administration-&gt;Services menu item.  You may also need to enable local clients in the System-&gt;Administration-&gt;Firewall menu item.</span></p>
    <p class="Standard" dir="ltr">To verify you have NFS connectivity try to manually mount it on the ZedBoard by typing, on the ZedBoard console:</p>
    <p class="Code" dir="ltr">% mount -t nfs -o udp,nolock,soft,intr &lt;ipaddr&gt;:&lt;dir&gt; /mnt/net</p>
    <p class="Standard" dir="ltr">Where <span class="Code">&lt;ipaddr&gt;</span> is the address of the development host, and <span class="Code">&lt;dir&gt;</span> is the directory being exported/shared by the server.  The OpenCPI directory will be underneath that directory.</p>
    <p class="Standard" dir="ltr">If that succeeds, you have a good NFS connection.  unmount it using the "<span class="Code">umount</span>" command since the automated scripts will mount it next.</p>
    <h4 dir="ltr" id="toc47"><span class="SectionNumber">5.1.3.8 </span><a id="RefHeadingToc333771235158909"></a>Run the Setup Scripts after Booting to Access the Development System</h4>
    <p class="Standard" dir="ltr">When Linux boots on the ZedBoard from the SD card created as above, it creates a memory-based root file system, initialized from decompressing the <span class="Code">uramdisk.image.gz</span> file on the SD card.  It also mounts the SD card itself as a file system, at <span class="Code">/mnt/card</span>.  This means that anything you write to the root file system is <span style="font-style:italic">not</span> persistent.  To create any persistent file you use SD file system, at <span class="Code">/mnt/card</span>.</p>
    <p class="Standard" dir="ltr">Our standard setup uses the built-in NFS client on the ZedBoard to access the OpenCPI source code base from these types of systems (in a development environment).</p>
    <p class="Standard" dir="ltr">After booting, and logging in as root (either via the serial console or ssh), the first command should be to <span class="Code">source</span> the startup script on the SD card, supplying the development host's IP address as an argument.</p>
    <p class="Code" dir="ltr">root@zynq:~# source /mnt/card/opencpi/mynetsetup.sh 10.0.1.108</p>
    <p class="Standard" dir="ltr">This command, executed <span style="font-style:italic">once per boot</span> (not per ssh login), are all that is necessary to enable OpenCPI (unless you take additional measures to execute them automatically at boot time).  If this script works ok, then it proves you can run OpenCPI utilities (and applications).</p>
    <p class="Standard" dir="ltr">After this commands is run after booting, any new logins will automatically run the appropriate setup actions for that login shell.</p>
    <h4 dir="ltr" id="toc48"><span class="SectionNumber">5.1.3.9 </span><a id="RefHeadingToc333791235158909"></a>Confirm OpenCPI Software Operation.</h4>
    <p class="Standard" dir="ltr">The <span class="Code">mynetsetup.sh</span> script above already sets the path to find OpenCPI executables and software components.  It may also change to some working directory.  Below "xxxxxx" is the path to get to the OpenCPI development tree.  The default setup script (that you modified), in fact changes to this directory in any case.  In standalone mode, it changes to the <span class="Code">/mnt/card/opencpi/xml</span> directory.</p>
    <p class="Standard" dir="ltr">To run a simple test application:</p>
    <p class="Code" dir="ltr">zynq&gt; ocpirun -v -d -mbias=rcc testbias</p>
    <p class="Standard" dir="ltr">This should run the <span class="Code">testbias</span> application (using file_read-&gt;bias-&gt;file_write) components, forcing it to run in software, and not the FPGA.</p>
    <h4 dir="ltr" id="toc49"><span class="SectionNumber">5.1.3.10 </span><a id="RefHeadingToc333811235158909"></a>Confirm OpenCPI Execution of an FPGA-based Application</h4>
    <p class="Standard" dir="ltr">There is no bitstream loaded on power up, but one will be loaded automatically as needed.  So, assuming your <span class="Code">OCPI_LIBRARY_PATH</span> points to the builtin bitstream (which the default setup file does in both network and standalone mode), you can run:</p>
    <p class="Code" dir="ltr">zynq&gt; ocpirun -v -d -mbias=hdl testbias</p>
    <p class="Standard" dir="ltr">which runs the same application with the bias component on the FPGA, with the appropriate bitstream being automatically loaded.</p>
    <h4 dir="ltr" id="toc50"><span class="SectionNumber">5.1.3.11 </span><a id="RefHeadingToc333831235158909"></a>Standalone Mode</h4>
    <p class="Standard" dir="ltr">To run in standalone mode, which has no requirement of a network, but can still use one if present, you run, after booting, the following command:</p>
    <p class="Code" dir="ltr"># source /mnt/card/opencpi/mysetup.sh</p>
    <p class="Standard" dir="ltr">This will set up the environment to run some applications locally based on files in the SD card, without accessing any files on the network.</p>
    <p class="Standard" dir="ltr">The <span class="Code">opencpi</span> subdirectory on the SD card has executables and scripts in the "<span class="Code">bin</span>" directory, component artifacts in the "<span class="Code">artifacts</span>" directory, and xml applications in the "<span class="Code">xml</span>" directory.</p>
    <p class="Standard" dir="ltr">The steps to run OpenCPI applications without and with FPGA components are in the previous two sections and work in standalone mode as well as network mode.</p>
    <h1 dir="ltr" id="toc51"><span class="SectionNumber">6 </span><a id="RefHeading91209798513454"></a>FPGA Platforms Based on PCI Express Cards</h1>
    <p class="Standard" dir="ltr">Any development host system that has PCI Express slots can host FPGA cards where the FPGA is attached directly to the PCI Express fabric.  All PCI Express-based FPGA cards require that the development host installation is complete and functional, including the Linux kernel driver.  At this point supported FPGA cards can be installed and used as OpenCPI processors that can host OpenCPI components built for those FPGAs.</p>
    <p class="Standard" dir="ltr">Each PCI Express-based FPGA card has its own installation issues, but most installations are similar.  Assuming there is already OpenCPI support for the card, the steps necessary to bring it up as an OpenCPI processor are:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Ensure sufficient power and cooling for the card</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Configure any required jumpers and/or switches on the card</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Enable bitstream loading, and JTAG access.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Plug in the card and power up the system</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Load an OpenCPI bit file into the power-up flash memory on the card</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Reboot the system</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Ensure the card is now recognized and usable.</p>
      </li>
    </ul>
    <h2 dir="ltr" id="toc52"><span class="SectionNumber">6.1 </span><a id="RefHeading2280924972471"></a>Installation of PCI Express-based FPGA Cards</h2>
    <p class="Standard" dir="ltr">This section describes the installation process in general that applies to all PCI Express-based FPGA cards.  Following sections provide specific details for some of the cards that are supported for OpenCPI.  We use the term “bitstream” in this section for the file containing an FPGA configuration to be loaded into the FPGA.  Bitstream files are created by the OpenCPI development process when the target platform is an “HDL” platform, which usually means an FPGA.</p>
    <h3 dir="ltr" id="toc53"><span class="SectionNumber">6.1.1 </span><a id="RefHeading2282924972471"></a>Ensure Sufficient Power and Cooling for the Card</h3>
    <p class="Standard" dir="ltr">PCI Express-based FPGA cards have a range of cooling and power requirements, and some even require that the chassis and box they are plugged into be left open for access to connectors etc.:  they are “lab cards” that remain fully exposed.  Others are typical PCI-Express cards that simply plug into a slot, and the box can be closed.  Frequently there are LEDs and other indicators, switches or displays that are useful to see when the card is fully exposed.</p>
    <p class="Standard" dir="ltr">Some cards require extra power supply cables to supply more power than is available through the backplane connector.  Some of these have their own “power blobs” that connect directly to AC outlets, while others have power cables that attach to the power harness in the box that usually supplies power to hard drives.  For the latter case you may need an adapter cable for the power harness in the system box.</p>
    <p class="Standard" dir="ltr">It is out of scope here to provide guidance on power and cooling issues, but ignoring the issues can frequently result in unreliable or broken hardware.  Usually the hardware manuals of these cards provide sufficient guidance.</p>
    <p class="Standard" dir="ltr">This step is complete when you have decided on how and where (which slot) the board should be plugged in, how it will receive sufficient cooling, and how its power supply requirements (and cables) will be satisfied.</p>
    <h3 dir="ltr" id="toc54"><span class="SectionNumber">6.1.2 </span><a id="RefHeading2284924972471"></a>Configure any Required Jumpers and/or Switches on the Card</h3>
    <p class="Standard" dir="ltr">Nearly all cards have hard-wired jumpers and switches that configure how the board should operate.  For the purpose of OpenCPI, the most common options relate to how the board powers up, and how the PCI-Express interface behaves.  For most cases you should configure the board so that it boots a bitstream from a part of flash memory that can be written with a new bitstream, usually via JTAG.  Even during active bitstream development and loading via JTAG, it is required to have a baseline OpenCPI bitstream loaded in flash memory that is automatically loaded on power up and reset.</p>
    <p class="Standard" dir="ltr">Some PCI-Express-based FPGA cards have an option to disconnect the PCI Express interface or to become the “root” of the PCI Express fabric.  Neither of these options should be selected.  The PCI-Express interface should be a normal peripheral endpoint (both master and slave) on the fabric.</p>
    <p class="Standard" dir="ltr">Some boards only re-load the bitstream from flash memory on power cycling, while others can/will also do it on system (PCI fabric) reset.</p>
    <h3 dir="ltr" id="toc55"><span class="SectionNumber">6.1.3 </span><a id="RefHeading2286924972471"></a>Enable Bitstream Loading, and JTAG Access.</h3>
    <p class="Standard" dir="ltr">As supported by OpenCPI, bitstreams can be loaded in one of 4 ways:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">On power-up and/or PCI-Express fabric reset, from on-board flash memory.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">On command, from on-board flash memory.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">On command, from JTAG</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">On command from some other processor-accessible interface.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr" style="font-style:italic">It is a roadmap item to support reloading a (part of) a bitstream via the PCI-Express interface itself.</p>
    <p class="Standard" dir="ltr">If JTAG is required (which it normally is) a cable (and possibly a “JTAG pod”) must be connected to the board, and to a (usually) USB port on the development system.</p>
    <p class="Standard" dir="ltr">When more than one card is in a system, and thus multiple JTAG cables are attached to multiple USB ports, the OpenCPI system must know which JTAG cable is connected to which card.  This is done by making this association in the OpenCPI system configuration file, in <span class="Code">/opt/opencpi/system.xml</span>.  An example is:</p>
    <p class="Code" dir="ltr"><span class="Code">&lt;opencpi&gt;<br />  &lt;container&gt;<br />    &lt;hdl&gt;<br />      &lt;device name="0000:05:00.0" esn="000013C1E1F401"/&gt;<br />    &lt;/hdl&gt;<br />  &lt;/container&gt;<br />  <span style="font-style:italic">...</span></span><span class="DefaultParagraphFont"><span style="font-style:italic">(other xml)</span><br /></span><span class="Code">&lt;/opencpi&gt;</span></p>
    <p class="Standard" dir="ltr">This example says:  the OpenCPI HDL (FPGA) device found at PCI slot named “0000:05:00.0” should be associated with the USB-based JTAG pod with the electronic serial number (ESN) of  <span class="Code">000013C1E1F401.</span><span class="DefaultParagraphFont">  The way to find the serial number is vendor-specific, but the OpenCPI script:  probeJtag will scan for JTAG cables for both Xilinx and Altera.  Unfortunately not every JTAG pod has such a serial number, and thus more than one of them cannot be used in a system.  The </span><span class="Code">lspci</span><span class="DefaultParagraphFont"> Linux utility can be used to list PCI-Express slots and information about the cards that are plugged into them.</span></p>
    <p class="Standard" dir="ltr"><span class="DefaultParagraphFont">This editing of the </span><span class="Code">system.xml</span><span class="DefaultParagraphFont"> file is only necessary when there is more than one such JTAG cable in a system.</span></p>
    <h3 dir="ltr" id="toc56"><span class="SectionNumber">6.1.4 </span><a id="RefHeading2288924972471"></a>Plug in the Card and Power up the System</h3>
    <p class="Standard" dir="ltr">After the cards are plugged in and the system is powered up, there is usually some board-specific LEDs that show that the power is good, the PCI Express bus is alive, and perhaps a factory default bitstream has been successfully loaded from flash.  See the sections for individual boards.</p>
    <h3 dir="ltr" id="toc57"><span class="SectionNumber">6.1.5 </span><a id="RefHeading2290924972471"></a>Load an OpenCPI Bitstream into the Power-up Flash Memory on the Card</h3>
    <p class="Standard" dir="ltr">OpenCPI FPGA PCI-Express cards will not be discovered by OpenCPI unless they are currently running a bitstream that was created by OpenCPI.  Thus part of installation is to write a bitstream to the card's flash memory.  As mentioned above, the board should be configured to boot from this flash on power up or PCI-Express reset.  A good candidate for loading is the “testbias” bitstream that is built for all supported platforms.  If you are in the top level of the OpenCPI tree, an example of loading this default bitstream is:</p>
    <p class="Code" dir="ltr">% loadFlash alst4 hdl/platforms/alst4/testbias_ml605_base.bitz \<br />    01c4b5f5</p>
    <p class="Standard" dir="ltr">This command loads the flash memory of an “alst4” PCI-Express card (the Altera Stratix4 development board) from the OpenCPI default bitstream for the alst4, using the JTAG pod whose serial number is 01c4b5f5.</p>
    <p class="Standard" dir="ltr">There is always also a vendor-specific method for those that are experienced users of that vendors tools, but the actual file to load would then not be the “.bitz” file but rather a vendor-specific file probably built as part of OpenCPI's build flow.</p>
    <p class="Standard" dir="ltr" style="font-style:italic">It is a roadmap item to specify the existence of a PCI-Express card in the system configuration file, and avoid the flash bitstream requirement.  This automatic mode is currently supported only on the ZedBoard embedded processor.</p>
    <h3 dir="ltr" id="toc58"><span class="SectionNumber">6.1.6 </span><a id="RefHeading2292924972471"></a>Reboot the System and Test OpenCPI's Ability to See the Card.</h3>
    <p class="Standard" dir="ltr">After the initial flash bitstream is installed on the card, power cycle the development host system.  Use the OpenCPI utility called <span class="Code">ocpihdl</span> to check that the board is found.  The following command will search for recognizable cards and print out their information:</p>
    <p class="Code" dir="ltr">% ocpihdl search</p>
    <p class="Standard" dir="ltr">This command should print out the cards it could find, along with the PCI-Express address for each.  If you have more than one of the same card, in different slots, you will see them both, although other than the slot, there is no other identifying information.</p>
    <p class="Standard" dir="ltr"><span style="font-style:italic">It is a roadmap item to display the electronic serial number of the card/chip itself, although not all boards or chips have such unique identification.</span></p>
    <h2 dir="ltr" id="toc59"><span class="SectionNumber">6.2 </span><a id="RefHeading2294924972471"></a><span style="font-style:italic">Xilinx ML605 PCI-Express Card as an OpenCPI HDL Platform</span></h2>
    <p class="Standard" dir="ltr">The ML605 is a PCI-Express-based Xilinx development board with a Virtex-6 FPGA, along with a variety of useful peripherals.  It costs $1795 (as of July 2014), and includes a license to the Xilinx tool set that is limited to targeting this exact board.  It can be purchased either from Xilinx directly, or through Avnet.  The URL page for this card is:</p>
    <p class="Code" dir="ltr">http://www.xilinx.com/products/boards-and-kits/EK-V6-ML605-G.htm</p>
    <h3 dir="ltr" id="toc60"><span class="SectionNumber">6.2.1 </span><a id="RefHeading2296924972471"></a>Hardware Setup for ML605</h3>
    <p class="Standard" dir="ltr">As with any exposed electronics, care should be taken with ESD (static electricity) when handling and configuring the board.  To configure the hardware, use the document: “UG534: ML605 Hardware User Guide”.</p>
    <p class="Standard" dir="ltr">There are many hardware options for how the ML605 can be used, but we focus here on the minimum changes from the default configuration that is supported by OpenCPI.</p>
    <p class="Standard" dir="ltr">The default settings of switches and jumpers are listed in Appendix B of the Xilinx document.  The non-default settings necessary for using the ML605 with OpenCPI are:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">Set the S2 DIP switches for “Slave SelectMAP Platform Flash XL” mode.<br />Per Table 1-27, S2.1: On, S2.2: Off, S2.3: Off, S2.4: On, S2.5: On</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Set jumper J42 to PCIe present with width x4 (short pins 3 and 4).<br />There is no technical reason why other PCI-Express widths could not be used, but the OpenCPI support for the ML605 has only been configured and tested for x4.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Remove the “legs” from the ML605 card so it can be inserted into the motherboard.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Ensure that SW2 (the external power switch) is set to OFF until after the board is plugged in.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Connect <span style="font-style:italic">EITHER</span> (one but <span style="font-style:italic">NOT BOTH</span>) the J25 connector to the PC power harness (typically used for hard drives) OR the J60 connector to the AC power adapter.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">Connect a USB cable to the JTAG USB port, and leave the other end unconnected.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">After the board is plugged into the PCI-Express slot, switch the SW2 power ON, and connect the JTAB/USB cable to a USB port on the development system.  The SW2 switch should be on whenever the system is powered up.</p>
    <p class="Standard" dir="ltr">If you have not yet loaded the initial OpenCPI bitstream into the flash memory on the ML605 card, it should boot the factory default bitstream.  In this case the Linux <span class="Code">lspci</span> command should show the board as a Xilinx vendor board.  After loading the initial OpenCPI bitstream into flash, and resetting the system, the <span class="Code">ocpihdl search</span> command should find it as an OpenCPI platform.  As mentioned earlier, use the loadFlash command to load the default bitstream into flash memory:</p>
    <p class="Code" dir="ltr">% loadFlash ml605 hdl/platforms/ml605/testbias_ml605_base.bitz \<br />   &lt;esn-for-jtag&gt;</p>
    <h2 dir="ltr" id="toc61" style="font-style:italic"><span class="SectionNumber">6.3 </span><a id="RefHeading2298924972471"></a>Altera ALST4 PCI-Express Card as an OpenCPI HDL Platform</h2>
    <p class="Standard" dir="ltr">This platform is the PCI-Express Altera development card for Stratix4, which has the smaller <span style="font-weight:bold">s4gx230</span><span style="font-weight:normal"> part on it.  The OpenCPI name for this platform is “alst4”.</span></p>
    <h2 dir="ltr" id="toc62" style="font-style:italic"><span class="SectionNumber">6.4 </span><a id="RefHeading2300924972471"></a>Altera ALST4X PCI-Express Card as an OpenCPI HDL Platform</h2>
    <p class="Standard" dir="ltr">This platform is the PCI-Express Altera development card for Stratix4, which has the larger <span style="font-weight:bold">s4gx530</span><span style="font-weight:normal"> part on it.  The OpenCPI name for this platform is “alst4x”.  It only differs from the ALST4 platform is that has a larger capacity FPGA chip on it.</span></p>
    <h1 dir="ltr" id="toc63"><span class="SectionNumber">7 </span><a id="RefHeading2302924972471"></a>FPGA Simulation Platforms</h1>
    <p class="Standard" dir="ltr">In OpenCPI, an FPGA simulator is “just another platform”.  You build “bitstreams” for it as a platform, and run component-based applications running components on this platform.  Using such simulators with OpenCPI is described in the OpenCPI Component Developer Guide.  Other than simply installing the simulation software according to the vendor's instructions, there a few addiitonal steps to use these simulators with OpenCPI.  The one OpenCPI-specific task for using the simulators as platforms is to set up various environment variables in the OpenCPI environment setup script.</p>
    <p class="Body" dir="ltr" style="font-style:italic">It is currently a roadmap item to run OpenCPI applications where some components are running in the simulator and some components are running on other platforms (software or FPGA).  Presently OpenCPI applications that run on the simulator must have all the components running in the simulator.  Note that the “file_read” and file_write” components do have implementations that run in simulators.</p>
    <h2 dir="ltr" id="toc64"><span class="SectionNumber">7.1 </span><a id="RefHeading2304924972471"></a>Modelsim</h2>
    <p class="Body" dir="ltr">Modelsim is a third party simulator offered by Mentor Graphics Corporation.  Although Altera provides a stripped down version of Modelsim, that version is not usable with OpenCPI since it does not support mixing VHDL and Verilog.</p>
    <p class="Body" dir="ltr">To use Modelsim with OpenCPI, you need the version that runs on the Linux OS running on your development host, and also that supports both VHDL and Verilog mixed in the same design.  CentOS6 and CentOS7 are supported.</p>
    <p class="Body" dir="ltr">To use Modelsim you must set the following environment variables in your OpenCPI environment setup script (that you “source” in new shell command windows):</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr">OCPI_MODELSIM_DIR should be set to the Modelsim installation directory.</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr">OCPI_MODELSIM_LICENSE_FILE should be set to the name of the license file.</p>
      </li>
    </ul>
    <p class="Standard" dir="ltr">These instructions have been used with node-locked Modelsim licenses.  Other license configurations my require other actions.</p>
    <h2 dir="ltr" id="toc65"><span class="SectionNumber">7.2 </span><a id="RefHeading2306924972471"></a>Xilinx Isim</h2>
    <p class="Body" dir="ltr">The <span class="Code">isim</span> simulator comes as part of the Xilinx ISE tool set.  It is fully supported as a target platform on which to execute OpenCPI subassemblies.</p>
    <p class="Body" dir="ltr">Using <span style="font-weight:bold">isim</span> requires no additional setup beyond installing the Xilinx ISE tool set for any other Xilinx platform.  The environment variables related to using <span class="Code">isim</span> are:</p>
    <ul class="listlevel1WWNum32">
      <li>
        <p class="ListBullet" dir="ltr"><span class="Code">OCPI_XILINX_DIR</span> for the Xilinx ISE installation directory (e.g. /opt/Xilinx)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr"><span class="Code">OCPI_XILINX_VERSION_DIR</span> for the version subdirectory (e.g. 14.7)</p>
      </li>
      <li>
        <p class="ListBullet" dir="ltr"><span class="Code">OCPI_XILINX_LICENSE_FILE</span> for the license file you are using.</p>
      </li>
    </ul>
    <p class="ListBullet" dir="ltr">As with ISE installations for hardware platforms, you must also “source” the environment script, “env/xilinx.sh” in your setup script.  An example section of an environment setup script for using Xilinx ISE is:</p>
    <p class="Code" dir="ltr">export OCPI_XILINX_DIR=/home/user1/Xilinx<br />export OCPI_XILINX_VERSION=14.7<br />export OCPI_XILINX_LICENSE_FILE=/home/user1/Xilinx/Xilinx-License.lic<br />source ./env/xilinx.sh</p>
    <h2 dir="ltr" id="toc66"><span class="SectionNumber">7.3 </span><a id="RefHeading2308924972471"></a>Xilinx xsim</h2>
    <p class="Body" dir="ltr">This is the simulator that comes with the Xilinx Vivado tool set.  It is currently not supported for OpenCPI.</p>
  </body>
</html>
